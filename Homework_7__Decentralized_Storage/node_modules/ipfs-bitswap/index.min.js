(function (root, factory) {(typeof module === 'object' && module.exports) ? module.exports = factory() : root.IpfsBitswap = factory()}(typeof self !== 'undefined' ? self : this, function () {
var IpfsBitswap=(()=>{var oa=Object.create;var it=Object.defineProperty;var aa=Object.getOwnPropertyDescriptor;var ca=Object.getOwnPropertyNames;var ua=Object.getPrototypeOf,la=Object.prototype.hasOwnProperty;var en=r=>it(r,"__esModule",{value:!0});var fa=(r,e)=>()=>(r&&(e=r(r=0)),e);var w=(r,e)=>()=>(e||r((e={exports:{}}).exports,e),e.exports),J=(r,e)=>{en(r);for(var t in e)it(r,t,{get:e[t],enumerable:!0})},ha=(r,e,t)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of ca(e))!la.call(r,n)&&n!=="default"&&it(r,n,{get:()=>e[n],enumerable:!(t=aa(e,n))||t.enumerable});return r},L=r=>ha(en(it(r!=null?oa(ua(r)):{},"default",r&&r.__esModule&&"default"in r?{get:()=>r.default,enumerable:!0}:{value:r,enumerable:!0})),r);var nn=w(st=>{u();"use strict";st.byteLength=da;st.toByteArray=ga;st.fromByteArray=ba;var ne=[],Q=[],pa=typeof Uint8Array!="undefined"?Uint8Array:Array,Mt="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(Be=0,tn=Mt.length;Be<tn;++Be)ne[Be]=Mt[Be],Q[Mt.charCodeAt(Be)]=Be;var Be,tn;Q["-".charCodeAt(0)]=62;Q["_".charCodeAt(0)]=63;function rn(r){var e=r.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var t=r.indexOf("=");t===-1&&(t=e);var n=t===e?0:4-t%4;return[t,n]}function da(r){var e=rn(r),t=e[0],n=e[1];return(t+n)*3/4-n}function ya(r,e,t){return(e+t)*3/4-t}function ga(r){var e,t=rn(r),n=t[0],i=t[1],s=new pa(ya(r,n,i)),o=0,a=i>0?n-4:n,c;for(c=0;c<a;c+=4)e=Q[r.charCodeAt(c)]<<18|Q[r.charCodeAt(c+1)]<<12|Q[r.charCodeAt(c+2)]<<6|Q[r.charCodeAt(c+3)],s[o++]=e>>16&255,s[o++]=e>>8&255,s[o++]=e&255;return i===2&&(e=Q[r.charCodeAt(c)]<<2|Q[r.charCodeAt(c+1)]>>4,s[o++]=e&255),i===1&&(e=Q[r.charCodeAt(c)]<<10|Q[r.charCodeAt(c+1)]<<4|Q[r.charCodeAt(c+2)]>>2,s[o++]=e>>8&255,s[o++]=e&255),s}function wa(r){return ne[r>>18&63]+ne[r>>12&63]+ne[r>>6&63]+ne[r&63]}function ma(r,e,t){for(var n,i=[],s=e;s<t;s+=3)n=(r[s]<<16&16711680)+(r[s+1]<<8&65280)+(r[s+2]&255),i.push(wa(n));return i.join("")}function ba(r){for(var e,t=r.length,n=t%3,i=[],s=16383,o=0,a=t-n;o<a;o+=s)i.push(ma(r,o,o+s>a?a:o+s));return n===1?(e=r[t-1],i.push(ne[e>>2]+ne[e<<4&63]+"==")):n===2&&(e=(r[t-2]<<8)+r[t-1],i.push(ne[e>>10]+ne[e>>4&63]+ne[e<<2&63]+"=")),i.join("")}});var sn=w(It=>{u();It.read=function(r,e,t,n,i){var s,o,a=i*8-n-1,c=(1<<a)-1,l=c>>1,f=-7,p=t?i-1:0,m=t?-1:1,F=r[e+p];for(p+=m,s=F&(1<<-f)-1,F>>=-f,f+=a;f>0;s=s*256+r[e+p],p+=m,f-=8);for(o=s&(1<<-f)-1,s>>=-f,f+=n;f>0;o=o*256+r[e+p],p+=m,f-=8);if(s===0)s=1-l;else{if(s===c)return o?NaN:(F?-1:1)*(1/0);o=o+Math.pow(2,n),s=s-l}return(F?-1:1)*o*Math.pow(2,s-n)};It.write=function(r,e,t,n,i,s){var o,a,c,l=s*8-i-1,f=(1<<l)-1,p=f>>1,m=i===23?Math.pow(2,-24)-Math.pow(2,-77):0,F=n?0:s-1,b=n?1:-1,A=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(a=isNaN(e)?1:0,o=f):(o=Math.floor(Math.log(e)/Math.LN2),e*(c=Math.pow(2,-o))<1&&(o--,c*=2),o+p>=1?e+=m/c:e+=m*Math.pow(2,1-p),e*c>=2&&(o++,c/=2),o+p>=f?(a=0,o=f):o+p>=1?(a=(e*c-1)*Math.pow(2,i),o=o+p):(a=e*Math.pow(2,p-1)*Math.pow(2,i),o=0));i>=8;r[t+F]=a&255,F+=b,a/=256,i-=8);for(o=o<<i|a,l+=i;l>0;r[t+F]=o&255,F+=b,o/=256,l-=8);r[t+F-b]|=A*128}});var ge=w(Pe=>{u();"use strict";var Pt=nn(),Oe=sn(),on=typeof Symbol=="function"&&typeof Symbol.for=="function"?Symbol.for("nodejs.util.inspect.custom"):null;Pe.Buffer=h;Pe.SlowBuffer=ka;Pe.INSPECT_MAX_BYTES=50;var ot=2147483647;Pe.kMaxLength=ot;h.TYPED_ARRAY_SUPPORT=_a();!h.TYPED_ARRAY_SUPPORT&&typeof console!="undefined"&&typeof console.error=="function"&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support.");function _a(){try{let r=new Uint8Array(1),e={foo:function(){return 42}};return Object.setPrototypeOf(e,Uint8Array.prototype),Object.setPrototypeOf(r,e),r.foo()===42}catch(r){return!1}}Object.defineProperty(h.prototype,"parent",{enumerable:!0,get:function(){if(!!h.isBuffer(this))return this.buffer}});Object.defineProperty(h.prototype,"offset",{enumerable:!0,get:function(){if(!!h.isBuffer(this))return this.byteOffset}});function fe(r){if(r>ot)throw new RangeError('The value "'+r+'" is invalid for option "size"');let e=new Uint8Array(r);return Object.setPrototypeOf(e,h.prototype),e}function h(r,e,t){if(typeof r=="number"){if(typeof e=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return jt(r)}return an(r,e,t)}h.poolSize=8192;function an(r,e,t){if(typeof r=="string")return Ba(r,e);if(ArrayBuffer.isView(r))return va(r);if(r==null)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof r);if(ie(r,ArrayBuffer)||r&&ie(r.buffer,ArrayBuffer)||typeof SharedArrayBuffer!="undefined"&&(ie(r,SharedArrayBuffer)||r&&ie(r.buffer,SharedArrayBuffer)))return Nt(r,e,t);if(typeof r=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');let n=r.valueOf&&r.valueOf();if(n!=null&&n!==r)return h.from(n,e,t);let i=Ea(r);if(i)return i;if(typeof Symbol!="undefined"&&Symbol.toPrimitive!=null&&typeof r[Symbol.toPrimitive]=="function")return h.from(r[Symbol.toPrimitive]("string"),e,t);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof r)}h.from=function(r,e,t){return an(r,e,t)};Object.setPrototypeOf(h.prototype,Uint8Array.prototype);Object.setPrototypeOf(h,Uint8Array);function cn(r){if(typeof r!="number")throw new TypeError('"size" argument must be of type number');if(r<0)throw new RangeError('The value "'+r+'" is invalid for option "size"')}function xa(r,e,t){return cn(r),r<=0?fe(r):e!==void 0?typeof t=="string"?fe(r).fill(e,t):fe(r).fill(e):fe(r)}h.alloc=function(r,e,t){return xa(r,e,t)};function jt(r){return cn(r),fe(r<0?0:Ut(r)|0)}h.allocUnsafe=function(r){return jt(r)};h.allocUnsafeSlow=function(r){return jt(r)};function Ba(r,e){if((typeof e!="string"||e==="")&&(e="utf8"),!h.isEncoding(e))throw new TypeError("Unknown encoding: "+e);let t=un(r,e)|0,n=fe(t),i=n.write(r,e);return i!==t&&(n=n.slice(0,i)),n}function Dt(r){let e=r.length<0?0:Ut(r.length)|0,t=fe(e);for(let n=0;n<e;n+=1)t[n]=r[n]&255;return t}function va(r){if(ie(r,Uint8Array)){let e=new Uint8Array(r);return Nt(e.buffer,e.byteOffset,e.byteLength)}return Dt(r)}function Nt(r,e,t){if(e<0||r.byteLength<e)throw new RangeError('"offset" is outside of buffer bounds');if(r.byteLength<e+(t||0))throw new RangeError('"length" is outside of buffer bounds');let n;return e===void 0&&t===void 0?n=new Uint8Array(r):t===void 0?n=new Uint8Array(r,e):n=new Uint8Array(r,e,t),Object.setPrototypeOf(n,h.prototype),n}function Ea(r){if(h.isBuffer(r)){let e=Ut(r.length)|0,t=fe(e);return t.length===0||r.copy(t,0,0,e),t}if(r.length!==void 0)return typeof r.length!="number"||qt(r.length)?fe(0):Dt(r);if(r.type==="Buffer"&&Array.isArray(r.data))return Dt(r.data)}function Ut(r){if(r>=ot)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+ot.toString(16)+" bytes");return r|0}function ka(r){return+r!=r&&(r=0),h.alloc(+r)}h.isBuffer=function(e){return e!=null&&e._isBuffer===!0&&e!==h.prototype};h.compare=function(e,t){if(ie(e,Uint8Array)&&(e=h.from(e,e.offset,e.byteLength)),ie(t,Uint8Array)&&(t=h.from(t,t.offset,t.byteLength)),!h.isBuffer(e)||!h.isBuffer(t))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(e===t)return 0;let n=e.length,i=t.length;for(let s=0,o=Math.min(n,i);s<o;++s)if(e[s]!==t[s]){n=e[s],i=t[s];break}return n<i?-1:i<n?1:0};h.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}};h.concat=function(e,t){if(!Array.isArray(e))throw new TypeError('"list" argument must be an Array of Buffers');if(e.length===0)return h.alloc(0);let n;if(t===void 0)for(t=0,n=0;n<e.length;++n)t+=e[n].length;let i=h.allocUnsafe(t),s=0;for(n=0;n<e.length;++n){let o=e[n];if(ie(o,Uint8Array))s+o.length>i.length?(h.isBuffer(o)||(o=h.from(o)),o.copy(i,s)):Uint8Array.prototype.set.call(i,o,s);else if(h.isBuffer(o))o.copy(i,s);else throw new TypeError('"list" argument must be an Array of Buffers');s+=o.length}return i};function un(r,e){if(h.isBuffer(r))return r.length;if(ArrayBuffer.isView(r)||ie(r,ArrayBuffer))return r.byteLength;if(typeof r!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof r);let t=r.length,n=arguments.length>2&&arguments[2]===!0;if(!n&&t===0)return 0;let i=!1;for(;;)switch(e){case"ascii":case"latin1":case"binary":return t;case"utf8":case"utf-8":return zt(r).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return t*2;case"hex":return t>>>1;case"base64":return xn(r).length;default:if(i)return n?-1:zt(r).length;e=(""+e).toLowerCase(),i=!0}}h.byteLength=un;function Sa(r,e,t){let n=!1;if((e===void 0||e<0)&&(e=0),e>this.length||((t===void 0||t>this.length)&&(t=this.length),t<=0)||(t>>>=0,e>>>=0,t<=e))return"";for(r||(r="utf8");;)switch(r){case"hex":return ja(this,e,t);case"utf8":case"utf-8":return hn(this,e,t);case"ascii":return Ia(this,e,t);case"latin1":case"binary":return Pa(this,e,t);case"base64":return Oa(this,e,t);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return Da(this,e,t);default:if(n)throw new TypeError("Unknown encoding: "+r);r=(r+"").toLowerCase(),n=!0}}h.prototype._isBuffer=!0;function ve(r,e,t){let n=r[e];r[e]=r[t],r[t]=n}h.prototype.swap16=function(){let e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let t=0;t<e;t+=2)ve(this,t,t+1);return this};h.prototype.swap32=function(){let e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let t=0;t<e;t+=4)ve(this,t,t+3),ve(this,t+1,t+2);return this};h.prototype.swap64=function(){let e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let t=0;t<e;t+=8)ve(this,t,t+7),ve(this,t+1,t+6),ve(this,t+2,t+5),ve(this,t+3,t+4);return this};h.prototype.toString=function(){let e=this.length;return e===0?"":arguments.length===0?hn(this,0,e):Sa.apply(this,arguments)};h.prototype.toLocaleString=h.prototype.toString;h.prototype.equals=function(e){if(!h.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e?!0:h.compare(this,e)===0};h.prototype.inspect=function(){let e="",t=Pe.INSPECT_MAX_BYTES;return e=this.toString("hex",0,t).replace(/(.{2})/g,"$1 ").trim(),this.length>t&&(e+=" ... "),"<Buffer "+e+">"};on&&(h.prototype[on]=h.prototype.inspect);h.prototype.compare=function(e,t,n,i,s){if(ie(e,Uint8Array)&&(e=h.from(e,e.offset,e.byteLength)),!h.isBuffer(e))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof e);if(t===void 0&&(t=0),n===void 0&&(n=e?e.length:0),i===void 0&&(i=0),s===void 0&&(s=this.length),t<0||n>e.length||i<0||s>this.length)throw new RangeError("out of range index");if(i>=s&&t>=n)return 0;if(i>=s)return-1;if(t>=n)return 1;if(t>>>=0,n>>>=0,i>>>=0,s>>>=0,this===e)return 0;let o=s-i,a=n-t,c=Math.min(o,a),l=this.slice(i,s),f=e.slice(t,n);for(let p=0;p<c;++p)if(l[p]!==f[p]){o=l[p],a=f[p];break}return o<a?-1:a<o?1:0};function ln(r,e,t,n,i){if(r.length===0)return-1;if(typeof t=="string"?(n=t,t=0):t>2147483647?t=2147483647:t<-2147483648&&(t=-2147483648),t=+t,qt(t)&&(t=i?0:r.length-1),t<0&&(t=r.length+t),t>=r.length){if(i)return-1;t=r.length-1}else if(t<0)if(i)t=0;else return-1;if(typeof e=="string"&&(e=h.from(e,n)),h.isBuffer(e))return e.length===0?-1:fn(r,e,t,n,i);if(typeof e=="number")return e=e&255,typeof Uint8Array.prototype.indexOf=="function"?i?Uint8Array.prototype.indexOf.call(r,e,t):Uint8Array.prototype.lastIndexOf.call(r,e,t):fn(r,[e],t,n,i);throw new TypeError("val must be string, number or Buffer")}function fn(r,e,t,n,i){let s=1,o=r.length,a=e.length;if(n!==void 0&&(n=String(n).toLowerCase(),n==="ucs2"||n==="ucs-2"||n==="utf16le"||n==="utf-16le")){if(r.length<2||e.length<2)return-1;s=2,o/=2,a/=2,t/=2}function c(f,p){return s===1?f[p]:f.readUInt16BE(p*s)}let l;if(i){let f=-1;for(l=t;l<o;l++)if(c(r,l)===c(e,f===-1?0:l-f)){if(f===-1&&(f=l),l-f+1===a)return f*s}else f!==-1&&(l-=l-f),f=-1}else for(t+a>o&&(t=o-a),l=t;l>=0;l--){let f=!0;for(let p=0;p<a;p++)if(c(r,l+p)!==c(e,p)){f=!1;break}if(f)return l}return-1}h.prototype.includes=function(e,t,n){return this.indexOf(e,t,n)!==-1};h.prototype.indexOf=function(e,t,n){return ln(this,e,t,n,!0)};h.prototype.lastIndexOf=function(e,t,n){return ln(this,e,t,n,!1)};function Aa(r,e,t,n){t=Number(t)||0;let i=r.length-t;n?(n=Number(n),n>i&&(n=i)):n=i;let s=e.length;n>s/2&&(n=s/2);let o;for(o=0;o<n;++o){let a=parseInt(e.substr(o*2,2),16);if(qt(a))return o;r[t+o]=a}return o}function Ca(r,e,t,n){return at(zt(e,r.length-t),r,t,n)}function Ta(r,e,t,n){return at(za(e),r,t,n)}function Fa(r,e,t,n){return at(xn(e),r,t,n)}function La(r,e,t,n){return at(qa(e,r.length-t),r,t,n)}h.prototype.write=function(e,t,n,i){if(t===void 0)i="utf8",n=this.length,t=0;else if(n===void 0&&typeof t=="string")i=t,n=this.length,t=0;else if(isFinite(t))t=t>>>0,isFinite(n)?(n=n>>>0,i===void 0&&(i="utf8")):(i=n,n=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");let s=this.length-t;if((n===void 0||n>s)&&(n=s),e.length>0&&(n<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");i||(i="utf8");let o=!1;for(;;)switch(i){case"hex":return Aa(this,e,t,n);case"utf8":case"utf-8":return Ca(this,e,t,n);case"ascii":case"latin1":case"binary":return Ta(this,e,t,n);case"base64":return Fa(this,e,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return La(this,e,t,n);default:if(o)throw new TypeError("Unknown encoding: "+i);i=(""+i).toLowerCase(),o=!0}};h.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function Oa(r,e,t){return e===0&&t===r.length?Pt.fromByteArray(r):Pt.fromByteArray(r.slice(e,t))}function hn(r,e,t){t=Math.min(r.length,t);let n=[],i=e;for(;i<t;){let s=r[i],o=null,a=s>239?4:s>223?3:s>191?2:1;if(i+a<=t){let c,l,f,p;switch(a){case 1:s<128&&(o=s);break;case 2:c=r[i+1],(c&192)==128&&(p=(s&31)<<6|c&63,p>127&&(o=p));break;case 3:c=r[i+1],l=r[i+2],(c&192)==128&&(l&192)==128&&(p=(s&15)<<12|(c&63)<<6|l&63,p>2047&&(p<55296||p>57343)&&(o=p));break;case 4:c=r[i+1],l=r[i+2],f=r[i+3],(c&192)==128&&(l&192)==128&&(f&192)==128&&(p=(s&15)<<18|(c&63)<<12|(l&63)<<6|f&63,p>65535&&p<1114112&&(o=p))}}o===null?(o=65533,a=1):o>65535&&(o-=65536,n.push(o>>>10&1023|55296),o=56320|o&1023),n.push(o),i+=a}return Ma(n)}var pn=4096;function Ma(r){let e=r.length;if(e<=pn)return String.fromCharCode.apply(String,r);let t="",n=0;for(;n<e;)t+=String.fromCharCode.apply(String,r.slice(n,n+=pn));return t}function Ia(r,e,t){let n="";t=Math.min(r.length,t);for(let i=e;i<t;++i)n+=String.fromCharCode(r[i]&127);return n}function Pa(r,e,t){let n="";t=Math.min(r.length,t);for(let i=e;i<t;++i)n+=String.fromCharCode(r[i]);return n}function ja(r,e,t){let n=r.length;(!e||e<0)&&(e=0),(!t||t<0||t>n)&&(t=n);let i="";for(let s=e;s<t;++s)i+=Wa[r[s]];return i}function Da(r,e,t){let n=r.slice(e,t),i="";for(let s=0;s<n.length-1;s+=2)i+=String.fromCharCode(n[s]+n[s+1]*256);return i}h.prototype.slice=function(e,t){let n=this.length;e=~~e,t=t===void 0?n:~~t,e<0?(e+=n,e<0&&(e=0)):e>n&&(e=n),t<0?(t+=n,t<0&&(t=0)):t>n&&(t=n),t<e&&(t=e);let i=this.subarray(e,t);return Object.setPrototypeOf(i,h.prototype),i};function j(r,e,t){if(r%1!=0||r<0)throw new RangeError("offset is not uint");if(r+e>t)throw new RangeError("Trying to access beyond buffer length")}h.prototype.readUintLE=h.prototype.readUIntLE=function(e,t,n){e=e>>>0,t=t>>>0,n||j(e,t,this.length);let i=this[e],s=1,o=0;for(;++o<t&&(s*=256);)i+=this[e+o]*s;return i};h.prototype.readUintBE=h.prototype.readUIntBE=function(e,t,n){e=e>>>0,t=t>>>0,n||j(e,t,this.length);let i=this[e+--t],s=1;for(;t>0&&(s*=256);)i+=this[e+--t]*s;return i};h.prototype.readUint8=h.prototype.readUInt8=function(e,t){return e=e>>>0,t||j(e,1,this.length),this[e]};h.prototype.readUint16LE=h.prototype.readUInt16LE=function(e,t){return e=e>>>0,t||j(e,2,this.length),this[e]|this[e+1]<<8};h.prototype.readUint16BE=h.prototype.readUInt16BE=function(e,t){return e=e>>>0,t||j(e,2,this.length),this[e]<<8|this[e+1]};h.prototype.readUint32LE=h.prototype.readUInt32LE=function(e,t){return e=e>>>0,t||j(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+this[e+3]*16777216};h.prototype.readUint32BE=h.prototype.readUInt32BE=function(e,t){return e=e>>>0,t||j(e,4,this.length),this[e]*16777216+(this[e+1]<<16|this[e+2]<<8|this[e+3])};h.prototype.readBigUInt64LE=ye(function(e){e=e>>>0,Ie(e,"offset");let t=this[e],n=this[e+7];(t===void 0||n===void 0)&&Ge(e,this.length-8);let i=t+this[++e]*2**8+this[++e]*2**16+this[++e]*2**24,s=this[++e]+this[++e]*2**8+this[++e]*2**16+n*2**24;return BigInt(i)+(BigInt(s)<<BigInt(32))});h.prototype.readBigUInt64BE=ye(function(e){e=e>>>0,Ie(e,"offset");let t=this[e],n=this[e+7];(t===void 0||n===void 0)&&Ge(e,this.length-8);let i=t*2**24+this[++e]*2**16+this[++e]*2**8+this[++e],s=this[++e]*2**24+this[++e]*2**16+this[++e]*2**8+n;return(BigInt(i)<<BigInt(32))+BigInt(s)});h.prototype.readIntLE=function(e,t,n){e=e>>>0,t=t>>>0,n||j(e,t,this.length);let i=this[e],s=1,o=0;for(;++o<t&&(s*=256);)i+=this[e+o]*s;return s*=128,i>=s&&(i-=Math.pow(2,8*t)),i};h.prototype.readIntBE=function(e,t,n){e=e>>>0,t=t>>>0,n||j(e,t,this.length);let i=t,s=1,o=this[e+--i];for(;i>0&&(s*=256);)o+=this[e+--i]*s;return s*=128,o>=s&&(o-=Math.pow(2,8*t)),o};h.prototype.readInt8=function(e,t){return e=e>>>0,t||j(e,1,this.length),this[e]&128?(255-this[e]+1)*-1:this[e]};h.prototype.readInt16LE=function(e,t){e=e>>>0,t||j(e,2,this.length);let n=this[e]|this[e+1]<<8;return n&32768?n|4294901760:n};h.prototype.readInt16BE=function(e,t){e=e>>>0,t||j(e,2,this.length);let n=this[e+1]|this[e]<<8;return n&32768?n|4294901760:n};h.prototype.readInt32LE=function(e,t){return e=e>>>0,t||j(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24};h.prototype.readInt32BE=function(e,t){return e=e>>>0,t||j(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]};h.prototype.readBigInt64LE=ye(function(e){e=e>>>0,Ie(e,"offset");let t=this[e],n=this[e+7];(t===void 0||n===void 0)&&Ge(e,this.length-8);let i=this[e+4]+this[e+5]*2**8+this[e+6]*2**16+(n<<24);return(BigInt(i)<<BigInt(32))+BigInt(t+this[++e]*2**8+this[++e]*2**16+this[++e]*2**24)});h.prototype.readBigInt64BE=ye(function(e){e=e>>>0,Ie(e,"offset");let t=this[e],n=this[e+7];(t===void 0||n===void 0)&&Ge(e,this.length-8);let i=(t<<24)+this[++e]*2**16+this[++e]*2**8+this[++e];return(BigInt(i)<<BigInt(32))+BigInt(this[++e]*2**24+this[++e]*2**16+this[++e]*2**8+n)});h.prototype.readFloatLE=function(e,t){return e=e>>>0,t||j(e,4,this.length),Oe.read(this,e,!0,23,4)};h.prototype.readFloatBE=function(e,t){return e=e>>>0,t||j(e,4,this.length),Oe.read(this,e,!1,23,4)};h.prototype.readDoubleLE=function(e,t){return e=e>>>0,t||j(e,8,this.length),Oe.read(this,e,!0,52,8)};h.prototype.readDoubleBE=function(e,t){return e=e>>>0,t||j(e,8,this.length),Oe.read(this,e,!1,52,8)};function R(r,e,t,n,i,s){if(!h.isBuffer(r))throw new TypeError('"buffer" argument must be a Buffer instance');if(e>i||e<s)throw new RangeError('"value" argument is out of bounds');if(t+n>r.length)throw new RangeError("Index out of range")}h.prototype.writeUintLE=h.prototype.writeUIntLE=function(e,t,n,i){if(e=+e,t=t>>>0,n=n>>>0,!i){let a=Math.pow(2,8*n)-1;R(this,e,t,n,a,0)}let s=1,o=0;for(this[t]=e&255;++o<n&&(s*=256);)this[t+o]=e/s&255;return t+n};h.prototype.writeUintBE=h.prototype.writeUIntBE=function(e,t,n,i){if(e=+e,t=t>>>0,n=n>>>0,!i){let a=Math.pow(2,8*n)-1;R(this,e,t,n,a,0)}let s=n-1,o=1;for(this[t+s]=e&255;--s>=0&&(o*=256);)this[t+s]=e/o&255;return t+n};h.prototype.writeUint8=h.prototype.writeUInt8=function(e,t,n){return e=+e,t=t>>>0,n||R(this,e,t,1,255,0),this[t]=e&255,t+1};h.prototype.writeUint16LE=h.prototype.writeUInt16LE=function(e,t,n){return e=+e,t=t>>>0,n||R(this,e,t,2,65535,0),this[t]=e&255,this[t+1]=e>>>8,t+2};h.prototype.writeUint16BE=h.prototype.writeUInt16BE=function(e,t,n){return e=+e,t=t>>>0,n||R(this,e,t,2,65535,0),this[t]=e>>>8,this[t+1]=e&255,t+2};h.prototype.writeUint32LE=h.prototype.writeUInt32LE=function(e,t,n){return e=+e,t=t>>>0,n||R(this,e,t,4,4294967295,0),this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=e&255,t+4};h.prototype.writeUint32BE=h.prototype.writeUInt32BE=function(e,t,n){return e=+e,t=t>>>0,n||R(this,e,t,4,4294967295,0),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=e&255,t+4};function dn(r,e,t,n,i){_n(e,n,i,r,t,7);let s=Number(e&BigInt(4294967295));r[t++]=s,s=s>>8,r[t++]=s,s=s>>8,r[t++]=s,s=s>>8,r[t++]=s;let o=Number(e>>BigInt(32)&BigInt(4294967295));return r[t++]=o,o=o>>8,r[t++]=o,o=o>>8,r[t++]=o,o=o>>8,r[t++]=o,t}function yn(r,e,t,n,i){_n(e,n,i,r,t,7);let s=Number(e&BigInt(4294967295));r[t+7]=s,s=s>>8,r[t+6]=s,s=s>>8,r[t+5]=s,s=s>>8,r[t+4]=s;let o=Number(e>>BigInt(32)&BigInt(4294967295));return r[t+3]=o,o=o>>8,r[t+2]=o,o=o>>8,r[t+1]=o,o=o>>8,r[t]=o,t+8}h.prototype.writeBigUInt64LE=ye(function(e,t=0){return dn(this,e,t,BigInt(0),BigInt("0xffffffffffffffff"))});h.prototype.writeBigUInt64BE=ye(function(e,t=0){return yn(this,e,t,BigInt(0),BigInt("0xffffffffffffffff"))});h.prototype.writeIntLE=function(e,t,n,i){if(e=+e,t=t>>>0,!i){let c=Math.pow(2,8*n-1);R(this,e,t,n,c-1,-c)}let s=0,o=1,a=0;for(this[t]=e&255;++s<n&&(o*=256);)e<0&&a===0&&this[t+s-1]!==0&&(a=1),this[t+s]=(e/o>>0)-a&255;return t+n};h.prototype.writeIntBE=function(e,t,n,i){if(e=+e,t=t>>>0,!i){let c=Math.pow(2,8*n-1);R(this,e,t,n,c-1,-c)}let s=n-1,o=1,a=0;for(this[t+s]=e&255;--s>=0&&(o*=256);)e<0&&a===0&&this[t+s+1]!==0&&(a=1),this[t+s]=(e/o>>0)-a&255;return t+n};h.prototype.writeInt8=function(e,t,n){return e=+e,t=t>>>0,n||R(this,e,t,1,127,-128),e<0&&(e=255+e+1),this[t]=e&255,t+1};h.prototype.writeInt16LE=function(e,t,n){return e=+e,t=t>>>0,n||R(this,e,t,2,32767,-32768),this[t]=e&255,this[t+1]=e>>>8,t+2};h.prototype.writeInt16BE=function(e,t,n){return e=+e,t=t>>>0,n||R(this,e,t,2,32767,-32768),this[t]=e>>>8,this[t+1]=e&255,t+2};h.prototype.writeInt32LE=function(e,t,n){return e=+e,t=t>>>0,n||R(this,e,t,4,2147483647,-2147483648),this[t]=e&255,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24,t+4};h.prototype.writeInt32BE=function(e,t,n){return e=+e,t=t>>>0,n||R(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=e&255,t+4};h.prototype.writeBigInt64LE=ye(function(e,t=0){return dn(this,e,t,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))});h.prototype.writeBigInt64BE=ye(function(e,t=0){return yn(this,e,t,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))});function gn(r,e,t,n,i,s){if(t+n>r.length)throw new RangeError("Index out of range");if(t<0)throw new RangeError("Index out of range")}function wn(r,e,t,n,i){return e=+e,t=t>>>0,i||gn(r,e,t,4,34028234663852886e22,-34028234663852886e22),Oe.write(r,e,t,n,23,4),t+4}h.prototype.writeFloatLE=function(e,t,n){return wn(this,e,t,!0,n)};h.prototype.writeFloatBE=function(e,t,n){return wn(this,e,t,!1,n)};function mn(r,e,t,n,i){return e=+e,t=t>>>0,i||gn(r,e,t,8,17976931348623157e292,-17976931348623157e292),Oe.write(r,e,t,n,52,8),t+8}h.prototype.writeDoubleLE=function(e,t,n){return mn(this,e,t,!0,n)};h.prototype.writeDoubleBE=function(e,t,n){return mn(this,e,t,!1,n)};h.prototype.copy=function(e,t,n,i){if(!h.isBuffer(e))throw new TypeError("argument should be a Buffer");if(n||(n=0),!i&&i!==0&&(i=this.length),t>=e.length&&(t=e.length),t||(t=0),i>0&&i<n&&(i=n),i===n||e.length===0||this.length===0)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw new RangeError("Index out of range");if(i<0)throw new RangeError("sourceEnd out of bounds");i>this.length&&(i=this.length),e.length-t<i-n&&(i=e.length-t+n);let s=i-n;return this===e&&typeof Uint8Array.prototype.copyWithin=="function"?this.copyWithin(t,n,i):Uint8Array.prototype.set.call(e,this.subarray(n,i),t),s};h.prototype.fill=function(e,t,n,i){if(typeof e=="string"){if(typeof t=="string"?(i=t,t=0,n=this.length):typeof n=="string"&&(i=n,n=this.length),i!==void 0&&typeof i!="string")throw new TypeError("encoding must be a string");if(typeof i=="string"&&!h.isEncoding(i))throw new TypeError("Unknown encoding: "+i);if(e.length===1){let o=e.charCodeAt(0);(i==="utf8"&&o<128||i==="latin1")&&(e=o)}}else typeof e=="number"?e=e&255:typeof e=="boolean"&&(e=Number(e));if(t<0||this.length<t||this.length<n)throw new RangeError("Out of range index");if(n<=t)return this;t=t>>>0,n=n===void 0?this.length:n>>>0,e||(e=0);let s;if(typeof e=="number")for(s=t;s<n;++s)this[s]=e;else{let o=h.isBuffer(e)?e:h.from(e,i),a=o.length;if(a===0)throw new TypeError('The value "'+e+'" is invalid for argument "value"');for(s=0;s<n-t;++s)this[s+t]=o[s%a]}return this};var Me={};function Rt(r,e,t){Me[r]=class extends t{constructor(){super();Object.defineProperty(this,"message",{value:e.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${r}]`,this.stack,delete this.name}get code(){return r}set code(i){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:i,writable:!0})}toString(){return`${this.name} [${r}]: ${this.message}`}}}Rt("ERR_BUFFER_OUT_OF_BOUNDS",function(r){return r?`${r} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"},RangeError);Rt("ERR_INVALID_ARG_TYPE",function(r,e){return`The "${r}" argument must be of type number. Received type ${typeof e}`},TypeError);Rt("ERR_OUT_OF_RANGE",function(r,e,t){let n=`The value of "${r}" is out of range.`,i=t;return Number.isInteger(t)&&Math.abs(t)>2**32?i=bn(String(t)):typeof t=="bigint"&&(i=String(t),(t>BigInt(2)**BigInt(32)||t<-(BigInt(2)**BigInt(32)))&&(i=bn(i)),i+="n"),n+=` It must be ${e}. Received ${i}`,n},RangeError);function bn(r){let e="",t=r.length,n=r[0]==="-"?1:0;for(;t>=n+4;t-=3)e=`_${r.slice(t-3,t)}${e}`;return`${r.slice(0,t)}${e}`}function Na(r,e,t){Ie(e,"offset"),(r[e]===void 0||r[e+t]===void 0)&&Ge(e,r.length-(t+1))}function _n(r,e,t,n,i,s){if(r>t||r<e){let o=typeof e=="bigint"?"n":"",a;throw s>3?e===0||e===BigInt(0)?a=`>= 0${o} and < 2${o} ** ${(s+1)*8}${o}`:a=`>= -(2${o} ** ${(s+1)*8-1}${o}) and < 2 ** ${(s+1)*8-1}${o}`:a=`>= ${e}${o} and <= ${t}${o}`,new Me.ERR_OUT_OF_RANGE("value",a,r)}Na(n,i,s)}function Ie(r,e){if(typeof r!="number")throw new Me.ERR_INVALID_ARG_TYPE(e,"number",r)}function Ge(r,e,t){throw Math.floor(r)!==r?(Ie(r,t),new Me.ERR_OUT_OF_RANGE(t||"offset","an integer",r)):e<0?new Me.ERR_BUFFER_OUT_OF_BOUNDS:new Me.ERR_OUT_OF_RANGE(t||"offset",`>= ${t?1:0} and <= ${e}`,r)}var Ua=/[^+/0-9A-Za-z-_]/g;function Ra(r){if(r=r.split("=")[0],r=r.trim().replace(Ua,""),r.length<2)return"";for(;r.length%4!=0;)r=r+"=";return r}function zt(r,e){e=e||1/0;let t,n=r.length,i=null,s=[];for(let o=0;o<n;++o){if(t=r.charCodeAt(o),t>55295&&t<57344){if(!i){if(t>56319){(e-=3)>-1&&s.push(239,191,189);continue}else if(o+1===n){(e-=3)>-1&&s.push(239,191,189);continue}i=t;continue}if(t<56320){(e-=3)>-1&&s.push(239,191,189),i=t;continue}t=(i-55296<<10|t-56320)+65536}else i&&(e-=3)>-1&&s.push(239,191,189);if(i=null,t<128){if((e-=1)<0)break;s.push(t)}else if(t<2048){if((e-=2)<0)break;s.push(t>>6|192,t&63|128)}else if(t<65536){if((e-=3)<0)break;s.push(t>>12|224,t>>6&63|128,t&63|128)}else if(t<1114112){if((e-=4)<0)break;s.push(t>>18|240,t>>12&63|128,t>>6&63|128,t&63|128)}else throw new Error("Invalid code point")}return s}function za(r){let e=[];for(let t=0;t<r.length;++t)e.push(r.charCodeAt(t)&255);return e}function qa(r,e){let t,n,i,s=[];for(let o=0;o<r.length&&!((e-=2)<0);++o)t=r.charCodeAt(o),n=t>>8,i=t%256,s.push(i),s.push(n);return s}function xn(r){return Pt.toByteArray(Ra(r))}function at(r,e,t,n){let i;for(i=0;i<n&&!(i+t>=e.length||i>=r.length);++i)e[i+t]=r[i];return i}function ie(r,e){return r instanceof e||r!=null&&r.constructor!=null&&r.constructor.name!=null&&r.constructor.name===e.name}function qt(r){return r!==r}var Wa=function(){let r="0123456789abcdef",e=new Array(256);for(let t=0;t<16;++t){let n=t*16;for(let i=0;i<16;++i)e[n+i]=r[t]+r[i]}return e}();function ye(r){return typeof BigInt=="undefined"?Ha:r}function Ha(){throw new Error("BigInt not supported")}});var Sn=w((Cl,kn)=>{u();var O=kn.exports={},se,oe;function Wt(){throw new Error("setTimeout has not been defined")}function Ht(){throw new Error("clearTimeout has not been defined")}(function(){try{typeof setTimeout=="function"?se=setTimeout:se=Wt}catch(r){se=Wt}try{typeof clearTimeout=="function"?oe=clearTimeout:oe=Ht}catch(r){oe=Ht}})();function Bn(r){if(se===setTimeout)return setTimeout(r,0);if((se===Wt||!se)&&setTimeout)return se=setTimeout,setTimeout(r,0);try{return se(r,0)}catch(e){try{return se.call(null,r,0)}catch(t){return se.call(this,r,0)}}}function $a(r){if(oe===clearTimeout)return clearTimeout(r);if((oe===Ht||!oe)&&clearTimeout)return oe=clearTimeout,clearTimeout(r);try{return oe(r)}catch(e){try{return oe.call(null,r)}catch(t){return oe.call(this,r)}}}var he=[],je=!1,Ee,ct=-1;function Ga(){!je||!Ee||(je=!1,Ee.length?he=Ee.concat(he):ct=-1,he.length&&vn())}function vn(){if(!je){var r=Bn(Ga);je=!0;for(var e=he.length;e;){for(Ee=he,he=[];++ct<e;)Ee&&Ee[ct].run();ct=-1,e=he.length}Ee=null,je=!1,$a(r)}}O.nextTick=function(r){var e=new Array(arguments.length-1);if(arguments.length>1)for(var t=1;t<arguments.length;t++)e[t-1]=arguments[t];he.push(new En(r,e)),he.length===1&&!je&&Bn(vn)};function En(r,e){this.fun=r,this.array=e}En.prototype.run=function(){this.fun.apply(null,this.array)};O.title="browser";O.browser=!0;O.env={};O.argv=[];O.version="";O.versions={};function pe(){}O.on=pe;O.addListener=pe;O.once=pe;O.off=pe;O.removeListener=pe;O.removeAllListeners=pe;O.emit=pe;O.prependListener=pe;O.prependOnceListener=pe;O.listeners=function(r){return[]};O.binding=function(r){throw new Error("process.binding is not supported")};O.cwd=function(){return"/"};O.chdir=function(r){throw new Error("process.chdir is not supported")};O.umask=function(){return 0}});var y,d,u=fa(()=>{y=L(ge()),d=L(Sn())});var Xn=w((Ql,Qn)=>{u();Qn.exports=Jn;var Vn=128,Mc=127,Ic=~Mc,Pc=Math.pow(2,31);function Jn(r,e,t){e=e||[],t=t||0;for(var n=t;r>=Pc;)e[t++]=r&255|Vn,r/=128;for(;r&Ic;)e[t++]=r&255|Vn,r>>>=7;return e[t]=r|0,Jn.bytes=t-n+1,e}});var Yn=w((Xl,Zn)=>{u();Zn.exports=Qt;var jc=128,Kn=127;function Qt(r,e){var t=0,e=e||0,n=0,i=e,s,o=r.length;do{if(i>=o)throw Qt.bytes=0,new RangeError("Could not decode varint");s=r[i++],t+=n<28?(s&Kn)<<n:(s&Kn)*Math.pow(2,n),n+=7}while(s>=jc);return Qt.bytes=i-e,t}});var ti=w((Kl,ei)=>{u();var Dc=Math.pow(2,7),Nc=Math.pow(2,14),Uc=Math.pow(2,21),Rc=Math.pow(2,28),zc=Math.pow(2,35),qc=Math.pow(2,42),Wc=Math.pow(2,49),Hc=Math.pow(2,56),$c=Math.pow(2,63);ei.exports=function(r){return r<Dc?1:r<Nc?2:r<Uc?3:r<Rc?4:r<zc?5:r<qc?6:r<Wc?7:r<Hc?8:r<$c?9:10}});var ni=w((Zl,ri)=>{u();ri.exports={encode:Xn(),decode:Yn(),encodingLength:ti()}});var oi=w((Yl,si)=>{u();"use strict";var ii=ni();si.exports=r=>{if(!(r instanceof Uint8Array))throw new Error("arg needs to be a Uint8Array");let e=[];for(;r.length>0;){let t=ii.decode(r);e.push(t),r=r.slice(ii.decode.bytes)}return e}});var ui=w((ef,ci)=>{u();ci.exports=Xt;var ai=128,Gc=127,Vc=~Gc,Jc=Math.pow(2,31);function Xt(r,e,t){if(Number.MAX_SAFE_INTEGER&&r>Number.MAX_SAFE_INTEGER)throw Xt.bytes=0,new RangeError("Could not encode varint");e=e||[],t=t||0;for(var n=t;r>=Jc;)e[t++]=r&255|ai,r/=128;for(;r&Vc;)e[t++]=r&255|ai,r>>>=7;return e[t]=r|0,Xt.bytes=t-n+1,e}});var hi=w((tf,fi)=>{u();fi.exports=Kt;var Qc=128,li=127;function Kt(r,e){var t=0,e=e||0,n=0,i=e,s,o=r.length;do{if(i>=o||n>49)throw Kt.bytes=0,new RangeError("Could not decode varint");s=r[i++],t+=n<28?(s&li)<<n:(s&li)*Math.pow(2,n),n+=7}while(s>=Qc);return Kt.bytes=i-e,t}});var di=w((rf,pi)=>{u();var Xc=Math.pow(2,7),Kc=Math.pow(2,14),Zc=Math.pow(2,21),Yc=Math.pow(2,28),eu=Math.pow(2,35),tu=Math.pow(2,42),ru=Math.pow(2,49),nu=Math.pow(2,56),iu=Math.pow(2,63);pi.exports=function(r){return r<Xc?1:r<Kc?2:r<Zc?3:r<Yc?4:r<eu?5:r<tu?6:r<ru?7:r<nu?8:r<iu?9:10}});var dt=w((nf,yi)=>{u();yi.exports={encode:ui(),decode:hi(),encodingLength:di()}});var mi=w((of,wi)=>{u();var Re=1e3,ze=Re*60,qe=ze*60,ke=qe*24,ou=ke*7,au=ke*365.25;wi.exports=function(r,e){e=e||{};var t=typeof r;if(t==="string"&&r.length>0)return cu(r);if(t==="number"&&isFinite(r))return e.long?lu(r):uu(r);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(r))};function cu(r){if(r=String(r),!(r.length>100)){var e=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(r);if(!!e){var t=parseFloat(e[1]),n=(e[2]||"ms").toLowerCase();switch(n){case"years":case"year":case"yrs":case"yr":case"y":return t*au;case"weeks":case"week":case"w":return t*ou;case"days":case"day":case"d":return t*ke;case"hours":case"hour":case"hrs":case"hr":case"h":return t*qe;case"minutes":case"minute":case"mins":case"min":case"m":return t*ze;case"seconds":case"second":case"secs":case"sec":case"s":return t*Re;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return t;default:return}}}}function uu(r){var e=Math.abs(r);return e>=ke?Math.round(r/ke)+"d":e>=qe?Math.round(r/qe)+"h":e>=ze?Math.round(r/ze)+"m":e>=Re?Math.round(r/Re)+"s":r+"ms"}function lu(r){var e=Math.abs(r);return e>=ke?yt(r,e,ke,"day"):e>=qe?yt(r,e,qe,"hour"):e>=ze?yt(r,e,ze,"minute"):e>=Re?yt(r,e,Re,"second"):r+" ms"}function yt(r,e,t,n){var i=e>=t*1.5;return Math.round(r/t)+" "+n+(i?"s":"")}});var _i=w((af,bi)=>{u();function fu(r){t.debug=t,t.default=t,t.coerce=c,t.disable=s,t.enable=i,t.enabled=o,t.humanize=mi(),t.destroy=l,Object.keys(r).forEach(f=>{t[f]=r[f]}),t.names=[],t.skips=[],t.formatters={};function e(f){let p=0;for(let m=0;m<f.length;m++)p=(p<<5)-p+f.charCodeAt(m),p|=0;return t.colors[Math.abs(p)%t.colors.length]}t.selectColor=e;function t(f){let p,m=null,F,b;function A(...I){if(!A.enabled)return;let P=A,U=Number(new Date),$=U-(p||U);P.diff=$,P.prev=p,P.curr=U,p=U,I[0]=t.coerce(I[0]),typeof I[0]!="string"&&I.unshift("%O");let N=0;I[0]=I[0].replace(/%([a-zA-Z%])/g,(G,q)=>{if(G==="%%")return"%";N++;let V=t.formatters[q];if(typeof V=="function"){let Le=I[N];G=V.call(P,Le),I.splice(N,1),N--}return G}),t.formatArgs.call(P,I),(P.log||t.log).apply(P,I)}return A.namespace=f,A.useColors=t.useColors(),A.color=t.selectColor(f),A.extend=n,A.destroy=t.destroy,Object.defineProperty(A,"enabled",{enumerable:!0,configurable:!1,get:()=>m!==null?m:(F!==t.namespaces&&(F=t.namespaces,b=t.enabled(f)),b),set:I=>{m=I}}),typeof t.init=="function"&&t.init(A),A}function n(f,p){let m=t(this.namespace+(typeof p=="undefined"?":":p)+f);return m.log=this.log,m}function i(f){t.save(f),t.namespaces=f,t.names=[],t.skips=[];let p,m=(typeof f=="string"?f:"").split(/[\s,]+/),F=m.length;for(p=0;p<F;p++)!m[p]||(f=m[p].replace(/\*/g,".*?"),f[0]==="-"?t.skips.push(new RegExp("^"+f.substr(1)+"$")):t.names.push(new RegExp("^"+f+"$")))}function s(){let f=[...t.names.map(a),...t.skips.map(a).map(p=>"-"+p)].join(",");return t.enable(""),f}function o(f){if(f[f.length-1]==="*")return!0;let p,m;for(p=0,m=t.skips.length;p<m;p++)if(t.skips[p].test(f))return!1;for(p=0,m=t.names.length;p<m;p++)if(t.names[p].test(f))return!0;return!1}function a(f){return f.toString().substring(2,f.toString().length-2).replace(/\.\*\?$/,"*")}function c(f){return f instanceof Error?f.stack||f.message:f}function l(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return t.enable(t.load()),t}bi.exports=fu});var xi=w((W,gt)=>{u();W.formatArgs=pu;W.save=du;W.load=yu;W.useColors=hu;W.storage=gu();W.destroy=(()=>{let r=!1;return()=>{r||(r=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})();W.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function hu(){return typeof window!="undefined"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs)?!0:typeof navigator!="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/)?!1:typeof document!="undefined"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window!="undefined"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator!="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||typeof navigator!="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function pu(r){if(r[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+r[0]+(this.useColors?"%c ":" ")+"+"+gt.exports.humanize(this.diff),!this.useColors)return;let e="color: "+this.color;r.splice(1,0,e,"color: inherit");let t=0,n=0;r[0].replace(/%[a-zA-Z%]/g,i=>{i!=="%%"&&(t++,i==="%c"&&(n=t))}),r.splice(n,0,e)}W.log=console.debug||console.log||(()=>{});function du(r){try{r?W.storage.setItem("debug",r):W.storage.removeItem("debug")}catch(e){}}function yu(){let r;try{r=W.storage.getItem("debug")}catch(e){}return!r&&typeof d.default!="undefined"&&"env"in d.default&&(r=d.default.env.DEBUG),r}function gu(){try{return localStorage}catch(r){}}gt.exports=_i()(W);var{formatters:wu}=gt.exports;wu.j=function(r){try{return JSON.stringify(r)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}});var Ei=w((ff,vi)=>{u();"use strict";vi.exports=mu;function mu(r,e){for(var t=new Array(arguments.length-1),n=0,i=2,s=!0;i<arguments.length;)t[n++]=arguments[i++];return new Promise(function(a,c){t[n]=function(f){if(s)if(s=!1,f)c(f);else{for(var p=new Array(arguments.length-1),m=0;m<p.length;)p[m++]=arguments[m];a.apply(null,p)}};try{r.apply(e||null,t)}catch(l){s&&(s=!1,c(l))}})}});var Ci=w(Ai=>{u();"use strict";var mt=Ai;mt.length=function(e){var t=e.length;if(!t)return 0;for(var n=0;--t%4>1&&e.charAt(t)==="=";)++n;return Math.ceil(e.length*3)/4-n};var We=new Array(64),ki=new Array(123);for(Y=0;Y<64;)ki[We[Y]=Y<26?Y+65:Y<52?Y+71:Y<62?Y-4:Y-59|43]=Y++;var Y;mt.encode=function(e,t,n){for(var i=null,s=[],o=0,a=0,c;t<n;){var l=e[t++];switch(a){case 0:s[o++]=We[l>>2],c=(l&3)<<4,a=1;break;case 1:s[o++]=We[c|l>>4],c=(l&15)<<2,a=2;break;case 2:s[o++]=We[c|l>>6],s[o++]=We[l&63],a=0;break}o>8191&&((i||(i=[])).push(String.fromCharCode.apply(String,s)),o=0)}return a&&(s[o++]=We[c],s[o++]=61,a===1&&(s[o++]=61)),i?(o&&i.push(String.fromCharCode.apply(String,s.slice(0,o))),i.join("")):String.fromCharCode.apply(String,s.slice(0,o))};var Si="invalid encoding";mt.decode=function(e,t,n){for(var i=n,s=0,o,a=0;a<e.length;){var c=e.charCodeAt(a++);if(c===61&&s>1)break;if((c=ki[c])===void 0)throw Error(Si);switch(s){case 0:o=c,s=1;break;case 1:t[n++]=o<<2|(c&48)>>4,o=c,s=2;break;case 2:t[n++]=(o&15)<<4|(c&60)>>2,o=c,s=3;break;case 3:t[n++]=(o&3)<<6|c,s=0;break}}if(s===1)throw Error(Si);return n-i};mt.test=function(e){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(e)}});var Fi=w((pf,Ti)=>{u();"use strict";Ti.exports=bt;function bt(){this._listeners={}}bt.prototype.on=function(e,t,n){return(this._listeners[e]||(this._listeners[e]=[])).push({fn:t,ctx:n||this}),this};bt.prototype.off=function(e,t){if(e===void 0)this._listeners={};else if(t===void 0)this._listeners[e]=[];else for(var n=this._listeners[e],i=0;i<n.length;)n[i].fn===t?n.splice(i,1):++i;return this};bt.prototype.emit=function(e){var t=this._listeners[e];if(t){for(var n=[],i=1;i<arguments.length;)n.push(arguments[i++]);for(i=0;i<t.length;)t[i].fn.apply(t[i++].ctx,n)}return this}});var Di=w((df,ji)=>{u();"use strict";ji.exports=Li(Li);function Li(r){return typeof Float32Array!="undefined"?function(){var e=new Float32Array([-0]),t=new Uint8Array(e.buffer),n=t[3]===128;function i(c,l,f){e[0]=c,l[f]=t[0],l[f+1]=t[1],l[f+2]=t[2],l[f+3]=t[3]}function s(c,l,f){e[0]=c,l[f]=t[3],l[f+1]=t[2],l[f+2]=t[1],l[f+3]=t[0]}r.writeFloatLE=n?i:s,r.writeFloatBE=n?s:i;function o(c,l){return t[0]=c[l],t[1]=c[l+1],t[2]=c[l+2],t[3]=c[l+3],e[0]}function a(c,l){return t[3]=c[l],t[2]=c[l+1],t[1]=c[l+2],t[0]=c[l+3],e[0]}r.readFloatLE=n?o:a,r.readFloatBE=n?a:o}():function(){function e(n,i,s,o){var a=i<0?1:0;if(a&&(i=-i),i===0)n(1/i>0?0:2147483648,s,o);else if(isNaN(i))n(2143289344,s,o);else if(i>34028234663852886e22)n((a<<31|2139095040)>>>0,s,o);else if(i<11754943508222875e-54)n((a<<31|Math.round(i/1401298464324817e-60))>>>0,s,o);else{var c=Math.floor(Math.log(i)/Math.LN2),l=Math.round(i*Math.pow(2,-c)*8388608)&8388607;n((a<<31|c+127<<23|l)>>>0,s,o)}}r.writeFloatLE=e.bind(null,Oi),r.writeFloatBE=e.bind(null,Mi);function t(n,i,s){var o=n(i,s),a=(o>>31)*2+1,c=o>>>23&255,l=o&8388607;return c===255?l?NaN:a*(1/0):c===0?a*1401298464324817e-60*l:a*Math.pow(2,c-150)*(l+8388608)}r.readFloatLE=t.bind(null,Ii),r.readFloatBE=t.bind(null,Pi)}(),typeof Float64Array!="undefined"?function(){var e=new Float64Array([-0]),t=new Uint8Array(e.buffer),n=t[7]===128;function i(c,l,f){e[0]=c,l[f]=t[0],l[f+1]=t[1],l[f+2]=t[2],l[f+3]=t[3],l[f+4]=t[4],l[f+5]=t[5],l[f+6]=t[6],l[f+7]=t[7]}function s(c,l,f){e[0]=c,l[f]=t[7],l[f+1]=t[6],l[f+2]=t[5],l[f+3]=t[4],l[f+4]=t[3],l[f+5]=t[2],l[f+6]=t[1],l[f+7]=t[0]}r.writeDoubleLE=n?i:s,r.writeDoubleBE=n?s:i;function o(c,l){return t[0]=c[l],t[1]=c[l+1],t[2]=c[l+2],t[3]=c[l+3],t[4]=c[l+4],t[5]=c[l+5],t[6]=c[l+6],t[7]=c[l+7],e[0]}function a(c,l){return t[7]=c[l],t[6]=c[l+1],t[5]=c[l+2],t[4]=c[l+3],t[3]=c[l+4],t[2]=c[l+5],t[1]=c[l+6],t[0]=c[l+7],e[0]}r.readDoubleLE=n?o:a,r.readDoubleBE=n?a:o}():function(){function e(n,i,s,o,a,c){var l=o<0?1:0;if(l&&(o=-o),o===0)n(0,a,c+i),n(1/o>0?0:2147483648,a,c+s);else if(isNaN(o))n(0,a,c+i),n(2146959360,a,c+s);else if(o>17976931348623157e292)n(0,a,c+i),n((l<<31|2146435072)>>>0,a,c+s);else{var f;if(o<22250738585072014e-324)f=o/5e-324,n(f>>>0,a,c+i),n((l<<31|f/4294967296)>>>0,a,c+s);else{var p=Math.floor(Math.log(o)/Math.LN2);p===1024&&(p=1023),f=o*Math.pow(2,-p),n(f*4503599627370496>>>0,a,c+i),n((l<<31|p+1023<<20|f*1048576&1048575)>>>0,a,c+s)}}}r.writeDoubleLE=e.bind(null,Oi,0,4),r.writeDoubleBE=e.bind(null,Mi,4,0);function t(n,i,s,o,a){var c=n(o,a+i),l=n(o,a+s),f=(l>>31)*2+1,p=l>>>20&2047,m=4294967296*(l&1048575)+c;return p===2047?m?NaN:f*(1/0):p===0?f*5e-324*m:f*Math.pow(2,p-1075)*(m+4503599627370496)}r.readDoubleLE=t.bind(null,Ii,0,4),r.readDoubleBE=t.bind(null,Pi,4,0)}(),r}function Oi(r,e,t){e[t]=r&255,e[t+1]=r>>>8&255,e[t+2]=r>>>16&255,e[t+3]=r>>>24}function Mi(r,e,t){e[t]=r>>>24,e[t+1]=r>>>16&255,e[t+2]=r>>>8&255,e[t+3]=r&255}function Ii(r,e){return(r[e]|r[e+1]<<8|r[e+2]<<16|r[e+3]<<24)>>>0}function Pi(r,e){return(r[e]<<24|r[e+1]<<16|r[e+2]<<8|r[e+3])>>>0}});var Ni=w((exports,module)=>{u();"use strict";module.exports=inquire;function inquire(moduleName){try{var mod=eval("quire".replace(/^/,"re"))(moduleName);if(mod&&(mod.length||Object.keys(mod).length))return mod}catch(r){}return null}});var Ri=w(Ui=>{u();"use strict";var Zt=Ui;Zt.length=function(e){for(var t=0,n=0,i=0;i<e.length;++i)n=e.charCodeAt(i),n<128?t+=1:n<2048?t+=2:(n&64512)==55296&&(e.charCodeAt(i+1)&64512)==56320?(++i,t+=4):t+=3;return t};Zt.read=function(e,t,n){var i=n-t;if(i<1)return"";for(var s=null,o=[],a=0,c;t<n;)c=e[t++],c<128?o[a++]=c:c>191&&c<224?o[a++]=(c&31)<<6|e[t++]&63:c>239&&c<365?(c=((c&7)<<18|(e[t++]&63)<<12|(e[t++]&63)<<6|e[t++]&63)-65536,o[a++]=55296+(c>>10),o[a++]=56320+(c&1023)):o[a++]=(c&15)<<12|(e[t++]&63)<<6|e[t++]&63,a>8191&&((s||(s=[])).push(String.fromCharCode.apply(String,o)),a=0);return s?(a&&s.push(String.fromCharCode.apply(String,o.slice(0,a))),s.join("")):String.fromCharCode.apply(String,o.slice(0,a))};Zt.write=function(e,t,n){for(var i=n,s,o,a=0;a<e.length;++a)s=e.charCodeAt(a),s<128?t[n++]=s:s<2048?(t[n++]=s>>6|192,t[n++]=s&63|128):(s&64512)==55296&&((o=e.charCodeAt(a+1))&64512)==56320?(s=65536+((s&1023)<<10)+(o&1023),++a,t[n++]=s>>18|240,t[n++]=s>>12&63|128,t[n++]=s>>6&63|128,t[n++]=s&63|128):(t[n++]=s>>12|224,t[n++]=s>>6&63|128,t[n++]=s&63|128);return n-i}});var qi=w((gf,zi)=>{u();"use strict";zi.exports=bu;function bu(r,e,t){var n=t||8192,i=n>>>1,s=null,o=n;return function(c){if(c<1||c>i)return r(c);o+c>n&&(s=r(n),o=0);var l=e.call(s,o,o+=c);return o&7&&(o=(o|7)+1),l}}});var Hi=w((wf,Wi)=>{u();"use strict";Wi.exports=D;var et=be();function D(r,e){this.lo=r>>>0,this.hi=e>>>0}var Se=D.zero=new D(0,0);Se.toNumber=function(){return 0};Se.zzEncode=Se.zzDecode=function(){return this};Se.length=function(){return 1};var _u=D.zeroHash="\0\0\0\0\0\0\0\0";D.fromNumber=function(e){if(e===0)return Se;var t=e<0;t&&(e=-e);var n=e>>>0,i=(e-n)/4294967296>>>0;return t&&(i=~i>>>0,n=~n>>>0,++n>4294967295&&(n=0,++i>4294967295&&(i=0))),new D(n,i)};D.from=function(e){if(typeof e=="number")return D.fromNumber(e);if(et.isString(e))if(et.Long)e=et.Long.fromString(e);else return D.fromNumber(parseInt(e,10));return e.low||e.high?new D(e.low>>>0,e.high>>>0):Se};D.prototype.toNumber=function(e){if(!e&&this.hi>>>31){var t=~this.lo+1>>>0,n=~this.hi>>>0;return t||(n=n+1>>>0),-(t+n*4294967296)}return this.lo+this.hi*4294967296};D.prototype.toLong=function(e){return et.Long?new et.Long(this.lo|0,this.hi|0,Boolean(e)):{low:this.lo|0,high:this.hi|0,unsigned:Boolean(e)}};var me=String.prototype.charCodeAt;D.fromHash=function(e){return e===_u?Se:new D((me.call(e,0)|me.call(e,1)<<8|me.call(e,2)<<16|me.call(e,3)<<24)>>>0,(me.call(e,4)|me.call(e,5)<<8|me.call(e,6)<<16|me.call(e,7)<<24)>>>0)};D.prototype.toHash=function(){return String.fromCharCode(this.lo&255,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,this.hi&255,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)};D.prototype.zzEncode=function(){var e=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^e)>>>0,this.lo=(this.lo<<1^e)>>>0,this};D.prototype.zzDecode=function(){var e=-(this.lo&1);return this.lo=((this.lo>>>1|this.hi<<31)^e)>>>0,this.hi=(this.hi>>>1^e)>>>0,this};D.prototype.length=function(){var e=this.lo,t=(this.lo>>>28|this.hi<<4)>>>0,n=this.hi>>>24;return n===0?t===0?e<16384?e<128?1:2:e<2097152?3:4:t<16384?t<128?5:6:t<2097152?7:8:n<128?9:10}});var be=w(Yt=>{u();"use strict";var g=Yt;g.asPromise=Ei();g.base64=Ci();g.EventEmitter=Fi();g.float=Di();g.inquire=Ni();g.utf8=Ri();g.pool=qi();g.LongBits=Hi();g.isNode=Boolean(typeof globalThis!="undefined"&&globalThis&&globalThis.process&&globalThis.process.versions&&globalThis.process.versions.node);g.global=g.isNode&&globalThis||typeof window!="undefined"&&window||typeof self!="undefined"&&self||Yt;g.emptyArray=Object.freeze?Object.freeze([]):[];g.emptyObject=Object.freeze?Object.freeze({}):{};g.isInteger=Number.isInteger||function(e){return typeof e=="number"&&isFinite(e)&&Math.floor(e)===e};g.isString=function(e){return typeof e=="string"||e instanceof String};g.isObject=function(e){return e&&typeof e=="object"};g.isset=g.isSet=function(e,t){var n=e[t];return n!=null&&e.hasOwnProperty(t)?typeof n!="object"||(Array.isArray(n)?n.length:Object.keys(n).length)>0:!1};g.Buffer=function(){try{var r=g.inquire("buffer").Buffer;return r.prototype.utf8Write?r:null}catch(e){return null}}();g._Buffer_from=null;g._Buffer_allocUnsafe=null;g.newBuffer=function(e){return typeof e=="number"?g.Buffer?g._Buffer_allocUnsafe(e):new g.Array(e):g.Buffer?g._Buffer_from(e):typeof Uint8Array=="undefined"?e:new Uint8Array(e)};g.Array=typeof Uint8Array!="undefined"?Uint8Array:Array;g.Long=g.global.dcodeIO&&g.global.dcodeIO.Long||g.global.Long||g.inquire("long");g.key2Re=/^true|false|0|1$/;g.key32Re=/^-?(?:0|[1-9][0-9]*)$/;g.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/;g.longToHash=function(e){return e?g.LongBits.from(e).toHash():g.LongBits.zeroHash};g.longFromHash=function(e,t){var n=g.LongBits.fromHash(e);return g.Long?g.Long.fromBits(n.lo,n.hi,t):n.toNumber(Boolean(t))};function $i(r,e,t){for(var n=Object.keys(e),i=0;i<n.length;++i)(r[n[i]]===void 0||!t)&&(r[n[i]]=e[n[i]]);return r}g.merge=$i;g.lcFirst=function(e){return e.charAt(0).toLowerCase()+e.substring(1)};function Gi(r){function e(t,n){if(!(this instanceof e))return new e(t,n);Object.defineProperty(this,"message",{get:function(){return t}}),Error.captureStackTrace?Error.captureStackTrace(this,e):Object.defineProperty(this,"stack",{value:new Error().stack||""}),n&&$i(this,n)}return(e.prototype=Object.create(Error.prototype)).constructor=e,Object.defineProperty(e.prototype,"name",{get:function(){return r}}),e.prototype.toString=function(){return this.name+": "+this.message},e}g.newError=Gi;g.ProtocolError=Gi("ProtocolError");g.oneOfGetter=function(e){for(var t={},n=0;n<e.length;++n)t[e[n]]=1;return function(){for(var i=Object.keys(this),s=i.length-1;s>-1;--s)if(t[i[s]]===1&&this[i[s]]!==void 0&&this[i[s]]!==null)return i[s]}};g.oneOfSetter=function(e){return function(t){for(var n=0;n<e.length;++n)e[n]!==t&&delete this[e[n]]}};g.toJSONOptions={longs:String,enums:String,bytes:String,json:!0};g._configure=function(){var r=g.Buffer;if(!r){g._Buffer_from=g._Buffer_allocUnsafe=null;return}g._Buffer_from=r.from!==Uint8Array.from&&r.from||function(t,n){return new r(t,n)},g._Buffer_allocUnsafe=r.allocUnsafe||function(t){return new r(t)}}});var or=w((bf,Xi)=>{u();"use strict";Xi.exports=x;var X=be(),er,_t=X.LongBits,Vi=X.base64,Ji=X.utf8;function tt(r,e,t){this.fn=r,this.len=e,this.next=void 0,this.val=t}function tr(){}function xu(r){this.head=r.head,this.tail=r.tail,this.len=r.len,this.next=r.states}function x(){this.len=0,this.head=new tt(tr,0,0),this.tail=this.head,this.states=null}var Qi=function(){return X.Buffer?function(){return(x.create=function(){return new er})()}:function(){return new x}};x.create=Qi();x.alloc=function(e){return new X.Array(e)};X.Array!==Array&&(x.alloc=X.pool(x.alloc,X.Array.prototype.subarray));x.prototype._push=function(e,t,n){return this.tail=this.tail.next=new tt(e,t,n),this.len+=t,this};function rr(r,e,t){e[t]=r&255}function Bu(r,e,t){for(;r>127;)e[t++]=r&127|128,r>>>=7;e[t]=r}function nr(r,e){this.len=r,this.next=void 0,this.val=e}nr.prototype=Object.create(tt.prototype);nr.prototype.fn=Bu;x.prototype.uint32=function(e){return this.len+=(this.tail=this.tail.next=new nr((e=e>>>0)<128?1:e<16384?2:e<2097152?3:e<268435456?4:5,e)).len,this};x.prototype.int32=function(e){return e<0?this._push(ir,10,_t.fromNumber(e)):this.uint32(e)};x.prototype.sint32=function(e){return this.uint32((e<<1^e>>31)>>>0)};function ir(r,e,t){for(;r.hi;)e[t++]=r.lo&127|128,r.lo=(r.lo>>>7|r.hi<<25)>>>0,r.hi>>>=7;for(;r.lo>127;)e[t++]=r.lo&127|128,r.lo=r.lo>>>7;e[t++]=r.lo}x.prototype.uint64=function(e){var t=_t.from(e);return this._push(ir,t.length(),t)};x.prototype.int64=x.prototype.uint64;x.prototype.sint64=function(e){var t=_t.from(e).zzEncode();return this._push(ir,t.length(),t)};x.prototype.bool=function(e){return this._push(rr,1,e?1:0)};function sr(r,e,t){e[t]=r&255,e[t+1]=r>>>8&255,e[t+2]=r>>>16&255,e[t+3]=r>>>24}x.prototype.fixed32=function(e){return this._push(sr,4,e>>>0)};x.prototype.sfixed32=x.prototype.fixed32;x.prototype.fixed64=function(e){var t=_t.from(e);return this._push(sr,4,t.lo)._push(sr,4,t.hi)};x.prototype.sfixed64=x.prototype.fixed64;x.prototype.float=function(e){return this._push(X.float.writeFloatLE,4,e)};x.prototype.double=function(e){return this._push(X.float.writeDoubleLE,8,e)};var vu=X.Array.prototype.set?function(e,t,n){t.set(e,n)}:function(e,t,n){for(var i=0;i<e.length;++i)t[n+i]=e[i]};x.prototype.bytes=function(e){var t=e.length>>>0;if(!t)return this._push(rr,1,0);if(X.isString(e)){var n=x.alloc(t=Vi.length(e));Vi.decode(e,n,0),e=n}return this.uint32(t)._push(vu,t,e)};x.prototype.string=function(e){var t=Ji.length(e);return t?this.uint32(t)._push(Ji.write,t,e):this._push(rr,1,0)};x.prototype.fork=function(){return this.states=new xu(this),this.head=this.tail=new tt(tr,0,0),this.len=0,this};x.prototype.reset=function(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new tt(tr,0,0),this.len=0),this};x.prototype.ldelim=function(){var e=this.head,t=this.tail,n=this.len;return this.reset().uint32(n),n&&(this.tail.next=e.next,this.tail=t,this.len+=n),this};x.prototype.finish=function(){for(var e=this.head.next,t=this.constructor.alloc(this.len),n=0;e;)e.fn(e.val,t,n),n+=e.len,e=e.next;return t};x._configure=function(r){er=r,x.create=Qi(),er._configure()}});var Yi=w((_f,Zi)=>{u();"use strict";Zi.exports=ae;var Ki=or();(ae.prototype=Object.create(Ki.prototype)).constructor=ae;var _e=be();function ae(){Ki.call(this)}ae._configure=function(){ae.alloc=_e._Buffer_allocUnsafe,ae.writeBytesBuffer=_e.Buffer&&_e.Buffer.prototype instanceof Uint8Array&&_e.Buffer.prototype.set.name==="set"?function(e,t,n){t.set(e,n)}:function(e,t,n){if(e.copy)e.copy(t,n,0,e.length);else for(var i=0;i<e.length;)t[n++]=e[i++]}};ae.prototype.bytes=function(e){_e.isString(e)&&(e=_e._Buffer_from(e,"base64"));var t=e.length>>>0;return this.uint32(t),t&&this._push(ae.writeBytesBuffer,t,e),this};function Eu(r,e,t){r.length<40?_e.utf8.write(r,e,t):e.utf8Write?e.utf8Write(r,t):e.write(r,t)}ae.prototype.string=function(e){var t=_e.Buffer.byteLength(e);return this.uint32(t),t&&this._push(Eu,t,e),this};ae._configure()});var ur=w((xf,is)=>{u();"use strict";is.exports=M;var ce=be(),ar,es=ce.LongBits,ku=ce.utf8;function ee(r,e){return RangeError("index out of range: "+r.pos+" + "+(e||1)+" > "+r.len)}function M(r){this.buf=r,this.pos=0,this.len=r.length}var ts=typeof Uint8Array!="undefined"?function(e){if(e instanceof Uint8Array||Array.isArray(e))return new M(e);throw Error("illegal buffer")}:function(e){if(Array.isArray(e))return new M(e);throw Error("illegal buffer")},rs=function(){return ce.Buffer?function(t){return(M.create=function(i){return ce.Buffer.isBuffer(i)?new ar(i):ts(i)})(t)}:ts};M.create=rs();M.prototype._slice=ce.Array.prototype.subarray||ce.Array.prototype.slice;M.prototype.uint32=function(){var e=4294967295;return function(){if(e=(this.buf[this.pos]&127)>>>0,this.buf[this.pos++]<128||(e=(e|(this.buf[this.pos]&127)<<7)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&127)<<14)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&127)<<21)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&15)<<28)>>>0,this.buf[this.pos++]<128))return e;if((this.pos+=5)>this.len)throw this.pos=this.len,ee(this,10);return e}}();M.prototype.int32=function(){return this.uint32()|0};M.prototype.sint32=function(){var e=this.uint32();return e>>>1^-(e&1)|0};function cr(){var r=new es(0,0),e=0;if(this.len-this.pos>4){for(;e<4;++e)if(r.lo=(r.lo|(this.buf[this.pos]&127)<<e*7)>>>0,this.buf[this.pos++]<128)return r;if(r.lo=(r.lo|(this.buf[this.pos]&127)<<28)>>>0,r.hi=(r.hi|(this.buf[this.pos]&127)>>4)>>>0,this.buf[this.pos++]<128)return r;e=0}else{for(;e<3;++e){if(this.pos>=this.len)throw ee(this);if(r.lo=(r.lo|(this.buf[this.pos]&127)<<e*7)>>>0,this.buf[this.pos++]<128)return r}return r.lo=(r.lo|(this.buf[this.pos++]&127)<<e*7)>>>0,r}if(this.len-this.pos>4){for(;e<5;++e)if(r.hi=(r.hi|(this.buf[this.pos]&127)<<e*7+3)>>>0,this.buf[this.pos++]<128)return r}else for(;e<5;++e){if(this.pos>=this.len)throw ee(this);if(r.hi=(r.hi|(this.buf[this.pos]&127)<<e*7+3)>>>0,this.buf[this.pos++]<128)return r}throw Error("invalid varint encoding")}M.prototype.bool=function(){return this.uint32()!==0};function xt(r,e){return(r[e-4]|r[e-3]<<8|r[e-2]<<16|r[e-1]<<24)>>>0}M.prototype.fixed32=function(){if(this.pos+4>this.len)throw ee(this,4);return xt(this.buf,this.pos+=4)};M.prototype.sfixed32=function(){if(this.pos+4>this.len)throw ee(this,4);return xt(this.buf,this.pos+=4)|0};function ns(){if(this.pos+8>this.len)throw ee(this,8);return new es(xt(this.buf,this.pos+=4),xt(this.buf,this.pos+=4))}M.prototype.float=function(){if(this.pos+4>this.len)throw ee(this,4);var e=ce.float.readFloatLE(this.buf,this.pos);return this.pos+=4,e};M.prototype.double=function(){if(this.pos+8>this.len)throw ee(this,4);var e=ce.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,e};M.prototype.bytes=function(){var e=this.uint32(),t=this.pos,n=this.pos+e;if(n>this.len)throw ee(this,e);return this.pos+=e,Array.isArray(this.buf)?this.buf.slice(t,n):t===n?new this.buf.constructor(0):this._slice.call(this.buf,t,n)};M.prototype.string=function(){var e=this.bytes();return ku.read(e,0,e.length)};M.prototype.skip=function(e){if(typeof e=="number"){if(this.pos+e>this.len)throw ee(this,e);this.pos+=e}else do if(this.pos>=this.len)throw ee(this);while(this.buf[this.pos++]&128);return this};M.prototype.skipType=function(r){switch(r){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;(r=this.uint32()&7)!=4;)this.skipType(r);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+r+" at offset "+this.pos)}return this};M._configure=function(r){ar=r,M.create=rs(),ar._configure();var e=ce.Long?"toLong":"toNumber";ce.merge(M.prototype,{int64:function(){return cr.call(this)[e](!1)},uint64:function(){return cr.call(this)[e](!0)},sint64:function(){return cr.call(this).zzDecode()[e](!1)},fixed64:function(){return ns.call(this)[e](!0)},sfixed64:function(){return ns.call(this)[e](!1)}})}});var cs=w((Bf,as)=>{u();"use strict";as.exports=Ae;var ss=ur();(Ae.prototype=Object.create(ss.prototype)).constructor=Ae;var os=be();function Ae(r){ss.call(this,r)}Ae._configure=function(){os.Buffer&&(Ae.prototype._slice=os.Buffer.prototype.slice)};Ae.prototype.string=function(){var e=this.uint32();return this.buf.utf8Slice?this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+e,this.len)):this.buf.toString("utf-8",this.pos,this.pos=Math.min(this.pos+e,this.len))};Ae._configure()});var ls=w((vf,us)=>{u();"use strict";us.exports=rt;var lr=be();(rt.prototype=Object.create(lr.EventEmitter.prototype)).constructor=rt;function rt(r,e,t){if(typeof r!="function")throw TypeError("rpcImpl must be a function");lr.EventEmitter.call(this),this.rpcImpl=r,this.requestDelimited=Boolean(e),this.responseDelimited=Boolean(t)}rt.prototype.rpcCall=function r(e,t,n,i,s){if(!i)throw TypeError("request must be specified");var o=this;if(!s)return lr.asPromise(r,o,e,t,n,i);if(!o.rpcImpl){setTimeout(function(){s(Error("already ended"))},0);return}try{return o.rpcImpl(e,t[o.requestDelimited?"encodeDelimited":"encode"](i).finish(),function(c,l){if(c)return o.emit("error",c,e),s(c);if(l===null){o.end(!0);return}if(!(l instanceof n))try{l=n[o.responseDelimited?"decodeDelimited":"decode"](l)}catch(f){return o.emit("error",f,e),s(f)}return o.emit("data",l,e),s(null,l)})}catch(a){o.emit("error",a,e),setTimeout(function(){s(a)},0);return}};rt.prototype.end=function(e){return this.rpcImpl&&(e||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this}});var hs=w(fs=>{u();"use strict";var Su=fs;Su.Service=ls()});var ds=w((kf,ps)=>{u();"use strict";ps.exports={}});var ws=w(gs=>{u();"use strict";var z=gs;z.build="minimal";z.Writer=or();z.BufferWriter=Yi();z.Reader=ur();z.BufferReader=cs();z.util=be();z.rpc=hs();z.roots=ds();z.configure=ys;function ys(){z.util._configure(),z.Writer._configure(z.BufferWriter),z.Reader._configure(z.BufferReader)}ys()});var bs=w((Af,ms)=>{u();"use strict";ms.exports=ws()});var vs=w((Uf,Bs)=>{u();"use strict";function xs(r,e){for(let t in e)Object.defineProperty(r,t,{value:e[t],enumerable:!0,configurable:!0});return r}function Tu(r,e,t){if(!r||typeof r=="string")throw new TypeError("Please pass an Error to err-code");t||(t={}),typeof e=="object"&&(t=e,e=""),e&&(t.code=e);try{return xs(r,t)}catch(n){t.message=r.message,t.stack=r.stack;let i=function(){};return i.prototype=Object.create(Object.getPrototypeOf(r)),xs(new i,t)}}Bs.exports=Tu});var Os=w((Kf,Ls)=>{u();Ls.exports=Fu;function Fu(r,e,t){var n=null,i=null,s=function(){n&&(clearTimeout(n),i=null,n=null)},o=function(){var c=i;s(),c&&c()},a=function(){if(!e)return r.apply(this,arguments);var c=this,l=arguments,f=t&&!n;if(s(),i=function(){r.apply(c,l)},n=setTimeout(function(){if(n=null,!f){var p=i;return i=null,p()}},e),f)return i()};return a.cancel=s,a.flush=o,a}});var yr=w((uh,Ps)=>{u();"use strict";var{Buffer:re}=ge(),Is=Symbol.for("BufferList");function C(r){if(!(this instanceof C))return new C(r);C._init.call(this,r)}C._init=function(e){Object.defineProperty(this,Is,{value:!0}),this._bufs=[],this.length=0,e&&this.append(e)};C.prototype._new=function(e){return new C(e)};C.prototype._offset=function(e){if(e===0)return[0,0];let t=0;for(let n=0;n<this._bufs.length;n++){let i=t+this._bufs[n].length;if(e<i||n===this._bufs.length-1)return[n,e-t];t=i}};C.prototype._reverseOffset=function(r){let e=r[0],t=r[1];for(let n=0;n<e;n++)t+=this._bufs[n].length;return t};C.prototype.get=function(e){if(e>this.length||e<0)return;let t=this._offset(e);return this._bufs[t[0]][t[1]]};C.prototype.slice=function(e,t){return typeof e=="number"&&e<0&&(e+=this.length),typeof t=="number"&&t<0&&(t+=this.length),this.copy(null,0,e,t)};C.prototype.copy=function(e,t,n,i){if((typeof n!="number"||n<0)&&(n=0),(typeof i!="number"||i>this.length)&&(i=this.length),n>=this.length||i<=0)return e||re.alloc(0);let s=!!e,o=this._offset(n),a=i-n,c=a,l=s&&t||0,f=o[1];if(n===0&&i===this.length){if(!s)return this._bufs.length===1?this._bufs[0]:re.concat(this._bufs,this.length);for(let p=0;p<this._bufs.length;p++)this._bufs[p].copy(e,l),l+=this._bufs[p].length;return e}if(c<=this._bufs[o[0]].length-f)return s?this._bufs[o[0]].copy(e,t,f,f+c):this._bufs[o[0]].slice(f,f+c);s||(e=re.allocUnsafe(a));for(let p=o[0];p<this._bufs.length;p++){let m=this._bufs[p].length-f;if(c>m)this._bufs[p].copy(e,l,f),l+=m;else{this._bufs[p].copy(e,l,f,f+c),l+=m;break}c-=m,f&&(f=0)}return e.length>l?e.slice(0,l):e};C.prototype.shallowSlice=function(e,t){if(e=e||0,t=typeof t!="number"?this.length:t,e<0&&(e+=this.length),t<0&&(t+=this.length),e===t)return this._new();let n=this._offset(e),i=this._offset(t),s=this._bufs.slice(n[0],i[0]+1);return i[1]===0?s.pop():s[s.length-1]=s[s.length-1].slice(0,i[1]),n[1]!==0&&(s[0]=s[0].slice(n[1])),this._new(s)};C.prototype.toString=function(e,t,n){return this.slice(t,n).toString(e)};C.prototype.consume=function(e){if(e=Math.trunc(e),Number.isNaN(e)||e<=0)return this;for(;this._bufs.length;)if(e>=this._bufs[0].length)e-=this._bufs[0].length,this.length-=this._bufs[0].length,this._bufs.shift();else{this._bufs[0]=this._bufs[0].slice(e),this.length-=e;break}return this};C.prototype.duplicate=function(){let e=this._new();for(let t=0;t<this._bufs.length;t++)e.append(this._bufs[t]);return e};C.prototype.append=function(e){if(e==null)return this;if(e.buffer)this._appendBuffer(re.from(e.buffer,e.byteOffset,e.byteLength));else if(Array.isArray(e))for(let t=0;t<e.length;t++)this.append(e[t]);else if(this._isBufferList(e))for(let t=0;t<e._bufs.length;t++)this.append(e._bufs[t]);else typeof e=="number"&&(e=e.toString()),this._appendBuffer(re.from(e));return this};C.prototype._appendBuffer=function(e){this._bufs.push(e),this.length+=e.length};C.prototype.indexOf=function(r,e,t){if(t===void 0&&typeof e=="string"&&(t=e,e=void 0),typeof r=="function"||Array.isArray(r))throw new TypeError('The "value" argument must be one of type string, Buffer, BufferList, or Uint8Array.');if(typeof r=="number"?r=re.from([r]):typeof r=="string"?r=re.from(r,t):this._isBufferList(r)?r=r.slice():Array.isArray(r.buffer)?r=re.from(r.buffer,r.byteOffset,r.byteLength):re.isBuffer(r)||(r=re.from(r)),e=Number(e||0),isNaN(e)&&(e=0),e<0&&(e=this.length+e),e<0&&(e=0),r.length===0)return e>this.length?this.length:e;let n=this._offset(e),i=n[0],s=n[1];for(;i<this._bufs.length;i++){let o=this._bufs[i];for(;s<o.length;)if(o.length-s>=r.length){let c=o.indexOf(r,s);if(c!==-1)return this._reverseOffset([i,c]);s=o.length-r.length+1}else{let c=this._reverseOffset([i,s]);if(this._match(c,r))return c;s++}s=0}return-1};C.prototype._match=function(r,e){if(this.length-r<e.length)return!1;for(let t=0;t<e.length;t++)if(this.get(r+t)!==e[t])return!1;return!0};(function(){let r={readDoubleBE:8,readDoubleLE:8,readFloatBE:4,readFloatLE:4,readInt32BE:4,readInt32LE:4,readUInt32BE:4,readUInt32LE:4,readInt16BE:2,readInt16LE:2,readUInt16BE:2,readUInt16LE:2,readInt8:1,readUInt8:1,readIntBE:null,readIntLE:null,readUIntBE:null,readUIntLE:null};for(let e in r)(function(t){r[t]===null?C.prototype[t]=function(n,i){return this.slice(n,n+i)[t](0,i)}:C.prototype[t]=function(n=0){return this.slice(n,n+r[t])[t](0)}})(e)})();C.prototype._isBufferList=function(e){return e instanceof C||C.isBufferList(e)};C.isBufferList=function(e){return e!=null&&e[Is]};Ps.exports=C});var gr=w((lh,Ns)=>{u();"use strict";var js=dt(),{Buffer:Lu}=ge(),Ds=(r,e,t)=>{let n=js.encode(r,e,t);return Ds.bytes=js.encode.bytes,e||Lu.from(n)};Ns.exports=Ds});var Hs=w((fh,vt)=>{u();"use strict";var{Buffer:Us}=ge(),Rs=yr(),zs=gr(),wr=8,qs=10*1024;function Ws(r){r=r||{};let e=Math.max(r.poolSize||qs,r.minPoolSize||wr),t=r.lengthEncoder||zs;return async function*(i){let s=Us.alloc(e),o=0;for await(let a of i){t(a.length,s,o);let c=s.slice(o,o+t.bytes);o+=t.bytes,s.length-o<wr&&(s=Us.alloc(e),o=0),yield new Rs().append(c).append(a)}}}Ws.single=(r,e)=>{e=e||{};let t=e.lengthEncoder||zs;return new Rs([t(r.length),r.slice()])};vt.exports=Ws;vt.exports.MIN_POOL_SIZE=wr;vt.exports.DEFAULT_POOL_SIZE=qs});var mr=w((hh,Vs)=>{u();"use strict";var $s=dt(),{Buffer:Ou}=ge(),Mu=r=>new Proxy({},{get:(e,t)=>t[0]==="l"?r[t]:r.get(parseInt(t))}),Gs=r=>{let e=$s.decode(Ou.isBuffer(r)?r:Mu(r));return Gs.bytes=$s.decode.bytes,e};Vs.exports=Gs});var Ks=w((ph,Et)=>{u();"use strict";var{Buffer:Iu}=ge(),br=yr(),Pu=mr(),Js=8,Qs=1024*1024*4,Xs=Iu.alloc(0),xe={LENGTH:"readLength",DATA:"readData"},ju={[xe.LENGTH]:(r,e,t,n)=>{e=e.append(r);let i;try{i=n.lengthDecoder(e)}catch(s){if(e.length>n.maxLengthLength)throw Object.assign(s,{message:"message length too long",code:"ERR_MSG_LENGTH_TOO_LONG"});if(s instanceof RangeError)return{mode:xe.LENGTH,buffer:e,chunk:void 0,state:void 0,data:void 0};throw s}if(i>n.maxDataLength)throw Object.assign(new Error("message data too long"),{code:"ERR_MSG_DATA_TOO_LONG"});return r=e.shallowSlice(n.lengthDecoder.bytes),e=new br,n.onLength&&n.onLength(i),i<=0?(n.onData&&n.onData(Xs),{mode:xe.LENGTH,chunk:r,buffer:e,data:Xs}):{mode:xe.DATA,chunk:r,buffer:e,state:{dataLength:i},data:void 0}},[xe.DATA]:(r,e,t,n)=>{if(e=e.append(r),!t)throw new Error("state is required");if(e.length<t.dataLength)return{mode:xe.DATA,buffer:e,state:t,chunk:void 0,data:void 0};let{dataLength:i}=t,s=e.shallowSlice(0,i),o=e.length>i?e.shallowSlice(i):void 0;return e=new br,n.onData&&n.onData(s),{mode:xe.LENGTH,chunk:o,buffer:e,state:void 0,data:s}}};function _r(r){r=r||{};let e={lengthDecoder:r.lengthDecoder||Pu,maxLengthLength:r.maxLengthLength||Js,maxDataLength:r.maxDataLength||Qs,onLength:r.onLength,onData:r.onData};return async function*(n){let i=new br,s=xe.LENGTH,o;for await(let a of n){let c=a;for(;c;){let l=ju[s](c,i,o,e);s=l.mode,c=l.chunk,i=l.buffer,o=l.state,l.data&&(yield l.data)}}if(i.length)throw Object.assign(new Error("unexpected end of input"),{code:"ERR_UNEXPECTED_EOF"})}}_r.fromReader=(r,e)=>{let t=1,n={[Symbol.asyncIterator](){return this},next:async()=>{try{return await r.next(t)}catch(s){if(s.code==="ERR_UNDER_READ")return{done:!0,value:null};throw s}finally{t=1}}};return _r({...e||{},onLength:s=>{t=s}})(n)};Et.exports=_r;Et.exports.MAX_LENGTH_LENGTH=Js;Et.exports.MAX_DATA_LENGTH=Qs});var eo=w((dh,Ys)=>{u();"use strict";var{Buffer:Du}=ge(),Zs=(r,e,t)=>(e=e||Du.allocUnsafe(4),e.writeInt32BE(r,t),e);Zs.bytes=4;Ys.exports=Zs});var no=w((yh,ro)=>{u();"use strict";var to=r=>{if(r.length<4)throw RangeError("Could not decode int32BE");return r.readInt32BE(0)};to.bytes=4;ro.exports=to});var io=w(Te=>{u();"use strict";Te.encode=Hs();Te.decode=Ks();Te.varintEncode=gr();Te.varintDecode=mr();Te.int32BEEncode=eo();Te.int32BEDecode=no()});var ao=w((wh,He)=>{u();var so=(...r)=>{let e;for(;r.length;)e=r.shift()(e);return e},xr=r=>r&&(typeof r[Symbol.asyncIterator]=="function"||typeof r[Symbol.iterator]=="function"||typeof r.next=="function"),kt=r=>r&&typeof r.sink=="function"&&xr(r.source),Nu=r=>e=>(r.sink(e),r.source),oo=(...r)=>{if(kt(r[0])){let e=r[0];r[0]=()=>e.source}else if(xr(r[0])){let e=r[0];r[0]=()=>e}if(r.length>1&&kt(r[r.length-1])&&(r[r.length-1]=r[r.length-1].sink),r.length>2)for(let e=1;e<r.length-1;e++)kt(r[e])&&(r[e]=Nu(r[e]));return so(...r)};He.exports=oo;He.exports.pipe=oo;He.exports.rawPipe=so;He.exports.isIterable=xr;He.exports.isDuplex=kt});var ho=w((mh,fo)=>{u();"use strict";var co=()=>{},uo=Symbol.for("@libp2p/js-interfaces/topology"),lo=class{constructor({min:e=0,max:t=1/0,handlers:n={}}){this.min=e,this.max=t,this._onConnect=n.onConnect||co,this._onDisconnect=n.onDisconnect||co,this.peers=new Set}get[Symbol.toStringTag](){return"Topology"}get[uo](){return!0}static isTopology(e){return Boolean(e&&e[uo])}set registrar(e){this._registrar=e}disconnect(e){this._onDisconnect(e)}};fo.exports=lo});var wo=w((bh,go)=>{u();"use strict";var Uu=ho(),po=Symbol.for("@libp2p/js-interfaces/topology/multicodec-topology"),yo=class extends Uu{constructor({min:e,max:t,multicodecs:n,handlers:i}){super({min:e,max:t,handlers:i});if(!n)throw new Error("one or more multicodec should be provided");if(!i)throw new Error("the handlers should be provided");if(typeof i.onConnect!="function")throw new Error("the 'onConnect' handler must be provided");if(typeof i.onDisconnect!="function")throw new Error("the 'onDisconnect' handler must be provided");this.multicodecs=Array.isArray(n)?n:[n],this._registrar=void 0,this._onProtocolChange=this._onProtocolChange.bind(this),this._onPeerConnect=this._onPeerConnect.bind(this)}get[Symbol.toStringTag](){return"Topology"}get[po](){return!0}static isMulticodecTopology(e){return Boolean(e&&e[po])}set registrar(e){this._registrar=e,this._registrar.peerStore.on("change:protocols",this._onProtocolChange),this._registrar.connectionManager.on("peer:connect",this._onPeerConnect),this._updatePeers(this._registrar.peerStore.peers.values())}_updatePeers(e){for(let{id:t,protocols:n}of e)if(this.multicodecs.filter(i=>n.includes(i)).length){this.peers.add(t.toB58String());let i=this._registrar.getConnection(t);i&&this._onConnect(t,i)}else this.peers.delete(t.toB58String())}_onProtocolChange({peerId:e,protocols:t}){let n=this.peers.has(e.toB58String()),i=t.filter(s=>this.multicodecs.includes(s));n&&i.length===0&&this._onDisconnect(e);for(let s of t)if(this.multicodecs.includes(s)){let o=this._registrar.peerStore.get(e);this._updatePeers([o]);return}}_onPeerConnect(e){let t=e.remotePeer,n=this._registrar.peerStore.protoBook.get(t);!n||this.multicodecs.find(i=>n.includes(i))&&(this.peers.add(t.toB58String()),this._onConnect(t,e))}};go.exports=yo});var Tt=w((Uh,Or)=>{u();"use strict";var $e=typeof Reflect=="object"?Reflect:null,Bo=$e&&typeof $e.apply=="function"?$e.apply:function(e,t,n){return Function.prototype.apply.call(e,t,n)},At;$e&&typeof $e.ownKeys=="function"?At=$e.ownKeys:Object.getOwnPropertySymbols?At=function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:At=function(e){return Object.getOwnPropertyNames(e)};function Hu(r){console&&console.warn&&console.warn(r)}var vo=Number.isNaN||function(e){return e!==e};function S(){S.init.call(this)}Or.exports=S;Or.exports.once=Ju;S.EventEmitter=S;S.prototype._events=void 0;S.prototype._eventsCount=0;S.prototype._maxListeners=void 0;var Eo=10;function Ct(r){if(typeof r!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof r)}Object.defineProperty(S,"defaultMaxListeners",{enumerable:!0,get:function(){return Eo},set:function(r){if(typeof r!="number"||r<0||vo(r))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+r+".");Eo=r}});S.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};S.prototype.setMaxListeners=function(e){if(typeof e!="number"||e<0||vo(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this};function ko(r){return r._maxListeners===void 0?S.defaultMaxListeners:r._maxListeners}S.prototype.getMaxListeners=function(){return ko(this)};S.prototype.emit=function(e){for(var t=[],n=1;n<arguments.length;n++)t.push(arguments[n]);var i=e==="error",s=this._events;if(s!==void 0)i=i&&s.error===void 0;else if(!i)return!1;if(i){var o;if(t.length>0&&(o=t[0]),o instanceof Error)throw o;var a=new Error("Unhandled error."+(o?" ("+o.message+")":""));throw a.context=o,a}var c=s[e];if(c===void 0)return!1;if(typeof c=="function")Bo(c,this,t);else for(var l=c.length,f=Fo(c,l),n=0;n<l;++n)Bo(f[n],this,t);return!0};function So(r,e,t,n){var i,s,o;if(Ct(t),s=r._events,s===void 0?(s=r._events=Object.create(null),r._eventsCount=0):(s.newListener!==void 0&&(r.emit("newListener",e,t.listener?t.listener:t),s=r._events),o=s[e]),o===void 0)o=s[e]=t,++r._eventsCount;else if(typeof o=="function"?o=s[e]=n?[t,o]:[o,t]:n?o.unshift(t):o.push(t),i=ko(r),i>0&&o.length>i&&!o.warned){o.warned=!0;var a=new Error("Possible EventEmitter memory leak detected. "+o.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");a.name="MaxListenersExceededWarning",a.emitter=r,a.type=e,a.count=o.length,Hu(a)}return r}S.prototype.addListener=function(e,t){return So(this,e,t,!1)};S.prototype.on=S.prototype.addListener;S.prototype.prependListener=function(e,t){return So(this,e,t,!0)};function $u(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function Ao(r,e,t){var n={fired:!1,wrapFn:void 0,target:r,type:e,listener:t},i=$u.bind(n);return i.listener=t,n.wrapFn=i,i}S.prototype.once=function(e,t){return Ct(t),this.on(e,Ao(this,e,t)),this};S.prototype.prependOnceListener=function(e,t){return Ct(t),this.prependListener(e,Ao(this,e,t)),this};S.prototype.removeListener=function(e,t){var n,i,s,o,a;if(Ct(t),i=this._events,i===void 0)return this;if(n=i[e],n===void 0)return this;if(n===t||n.listener===t)--this._eventsCount==0?this._events=Object.create(null):(delete i[e],i.removeListener&&this.emit("removeListener",e,n.listener||t));else if(typeof n!="function"){for(s=-1,o=n.length-1;o>=0;o--)if(n[o]===t||n[o].listener===t){a=n[o].listener,s=o;break}if(s<0)return this;s===0?n.shift():Gu(n,s),n.length===1&&(i[e]=n[0]),i.removeListener!==void 0&&this.emit("removeListener",e,a||t)}return this};S.prototype.off=S.prototype.removeListener;S.prototype.removeAllListeners=function(e){var t,n,i;if(n=this._events,n===void 0)return this;if(n.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):n[e]!==void 0&&(--this._eventsCount==0?this._events=Object.create(null):delete n[e]),this;if(arguments.length===0){var s=Object.keys(n),o;for(i=0;i<s.length;++i)o=s[i],o!=="removeListener"&&this.removeAllListeners(o);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(t=n[e],typeof t=="function")this.removeListener(e,t);else if(t!==void 0)for(i=t.length-1;i>=0;i--)this.removeListener(e,t[i]);return this};function Co(r,e,t){var n=r._events;if(n===void 0)return[];var i=n[e];return i===void 0?[]:typeof i=="function"?t?[i.listener||i]:[i]:t?Vu(i):Fo(i,i.length)}S.prototype.listeners=function(e){return Co(this,e,!0)};S.prototype.rawListeners=function(e){return Co(this,e,!1)};S.listenerCount=function(r,e){return typeof r.listenerCount=="function"?r.listenerCount(e):To.call(r,e)};S.prototype.listenerCount=To;function To(r){var e=this._events;if(e!==void 0){var t=e[r];if(typeof t=="function")return 1;if(t!==void 0)return t.length}return 0}S.prototype.eventNames=function(){return this._eventsCount>0?At(this._events):[]};function Fo(r,e){for(var t=new Array(e),n=0;n<e;++n)t[n]=r[n];return t}function Gu(r,e){for(;e+1<r.length;e++)r[e]=r[e+1];r.pop()}function Vu(r){for(var e=new Array(r.length),t=0;t<e.length;++t)e[t]=r[t].listener||r[t];return e}function Ju(r,e){return new Promise(function(t,n){function i(o){r.removeListener(e,s),n(o)}function s(){typeof r.removeListener=="function"&&r.removeListener("error",i),t([].slice.call(arguments))}Lo(r,e,s,{once:!0}),e!=="error"&&Qu(r,i,{once:!0})})}function Qu(r,e,t){typeof r.on=="function"&&Lo(r,"error",e,t)}function Lo(r,e,t,n){if(typeof r.on=="function")n.once?r.once(e,t):r.on(e,t);else if(typeof r.addEventListener=="function")r.addEventListener(e,function i(s){n.once&&r.removeEventListener(e,i),t(s)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof r)}});var Ro=w((No,Uo)=>{u();"use strict";var hl=Math.exp;No=Uo.exports=function(e){if(typeof e!="number")throw new Error("must provide a timespan to the moving average constructor");if(e<=0)throw new Error("must provide a timespan > 0 to the moving average constructor");let t,n=0,i=0,s=0,o,a={};function c(l,f){return 1-hl(-(l-f)/e)}return a.push=function(f,p){if(o){let m=c(f,o),F=p-t,b=m*F;t=m*p+(1-m)*t,n=(1-m)*(n+F*b),i=Math.sqrt(n),s=t+m*F}else t=p;o=f},a.movingAverage=function(){return t},a.variance=function(){return n},a.deviation=function(){return i},a.forecast=function(){return s},a}});var $o=w((yp,Lt)=>{u();"use strict";var{AbortController:Ho,AbortSignal:pl}=typeof self!="undefined"?self:typeof window!="undefined"?window:void 0;Lt.exports=Ho;Lt.exports.AbortSignal=pl;Lt.exports.default=Ho});var Jr=w((gp,Vr)=>{u();"use strict";var Ot;globalThis.AbortController&&globalThis.AbortSignal?Ot=globalThis:Ot=$o();Vr.exports.AbortSignal=Ot.AbortSignal;Vr.exports.AbortController=Ot.AbortController});var Vo=w((wp,Qr)=>{u();var{AbortController:dl}=Jr();function Go(r){let e=new dl;function t(){e.abort();for(let n of r)!n||!n.removeEventListener||n.removeEventListener("abort",t)}for(let n of r)if(!(!n||!n.addEventListener)){if(n.aborted){t();break}n.addEventListener("abort",t)}return e.signal}Qr.exports=Go;Qr.exports.anySignal=Go});var Qo=w((mp,Jo)=>{u();"use strict";var yl=async r=>{for await(let e of r);};Jo.exports=yl});var Ko=w((bp,Xo)=>{u();"use strict";var gl=async function*(r,e){for await(let t of r)await e(t)&&(yield t)};Xo.exports=gl});var Yo=w((_p,Zo)=>{u();"use strict";var wl=async function*(r,e){let t=0;if(!(e<1)){for await(let n of r)if(yield n,t++,t===e)return}};Zo.exports=wl});var ta=w((xp,ea)=>{u();"use strict";var ml=async r=>{let e=[];for await(let t of r)e.push(t);return e};ea.exports=ml});var Bl={};J(Bl,{createBitswap:()=>xl});u();u();u();u();u();u();u();var Va=Cn,An=128,Ja=127,Qa=~Ja,Xa=Math.pow(2,31);function Cn(r,e,t){e=e||[],t=t||0;for(var n=t;r>=Xa;)e[t++]=r&255|An,r/=128;for(;r&Qa;)e[t++]=r&255|An,r>>>=7;return e[t]=r|0,Cn.bytes=t-n+1,e}var Ka=$t,Za=128,Tn=127;function $t(r,e){var t=0,e=e||0,n=0,i=e,s,o=r.length;do{if(i>=o)throw $t.bytes=0,new RangeError("Could not decode varint");s=r[i++],t+=n<28?(s&Tn)<<n:(s&Tn)*Math.pow(2,n),n+=7}while(s>=Za);return $t.bytes=i-e,t}var Ya=Math.pow(2,7),ec=Math.pow(2,14),tc=Math.pow(2,21),rc=Math.pow(2,28),nc=Math.pow(2,35),ic=Math.pow(2,42),sc=Math.pow(2,49),oc=Math.pow(2,56),ac=Math.pow(2,63),cc=function(r){return r<Ya?1:r<ec?2:r<tc?3:r<rc?4:r<nc?5:r<ic?6:r<sc?7:r<oc?8:r<ac?9:10},uc={encode:Va,decode:Ka,encodingLength:cc},lc=uc,Ve=lc;var Je=r=>[Ve.decode(r),Ve.decode.bytes],De=(r,e,t=0)=>(Ve.encode(r,e,t),e),Ne=r=>Ve.encodingLength(r);u();u();var Ol=new Uint8Array(0);var Ln=(r,e)=>{if(r===e)return!0;if(r.byteLength!==e.byteLength)return!1;for(let t=0;t<r.byteLength;t++)if(r[t]!==e[t])return!1;return!0},de=r=>{if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")};var On=r=>new TextEncoder().encode(r),Mn=r=>new TextDecoder().decode(r);var ut=(r,e)=>{let t=e.byteLength,n=Ne(r),i=n+Ne(t),s=new Uint8Array(i+t);return De(r,s,0),De(t,s,n),s.set(e,i),new Qe(r,t,e,s)},Pn=r=>{let e=de(r),[t,n]=Je(e),[i,s]=Je(e.subarray(n)),o=e.subarray(n+s);if(o.byteLength!==i)throw new Error("Incorrect length");return new Qe(t,i,o,e)},jn=(r,e)=>r===e?!0:r.code===e.code&&r.size===e.size&&Ln(r.bytes,e.bytes),Qe=class{constructor(e,t,n,i){this.code=e,this.size=t,this.digest=n,this.bytes=i}};var Gt={};J(Gt,{base58btc:()=>B,base58flickr:()=>gc});u();u();u();function fc(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),n=0;n<t.length;n++)t[n]=255;for(var i=0;i<r.length;i++){var s=r.charAt(i),o=s.charCodeAt(0);if(t[o]!==255)throw new TypeError(s+" is ambiguous");t[o]=i}var a=r.length,c=r.charAt(0),l=Math.log(a)/Math.log(256),f=Math.log(256)/Math.log(a);function p(b){if(b instanceof Uint8Array||(ArrayBuffer.isView(b)?b=new Uint8Array(b.buffer,b.byteOffset,b.byteLength):Array.isArray(b)&&(b=Uint8Array.from(b))),!(b instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(b.length===0)return"";for(var A=0,I=0,P=0,U=b.length;P!==U&&b[P]===0;)P++,A++;for(var $=(U-P)*f+1>>>0,N=new Uint8Array($);P!==U;){for(var Z=b[P],G=0,q=$-1;(Z!==0||G<I)&&q!==-1;q--,G++)Z+=256*N[q]>>>0,N[q]=Z%a>>>0,Z=Z/a>>>0;if(Z!==0)throw new Error("Non-zero carry");I=G,P++}for(var V=$-I;V!==$&&N[V]===0;)V++;for(var Le=c.repeat(A);V<$;++V)Le+=r.charAt(N[V]);return Le}function m(b){if(typeof b!="string")throw new TypeError("Expected String");if(b.length===0)return new Uint8Array;var A=0;if(b[A]!==" "){for(var I=0,P=0;b[A]===c;)I++,A++;for(var U=(b.length-A)*l+1>>>0,$=new Uint8Array(U);b[A];){var N=t[b.charCodeAt(A)];if(N===255)return;for(var Z=0,G=U-1;(N!==0||Z<P)&&G!==-1;G--,Z++)N+=a*$[G]>>>0,$[G]=N%256>>>0,N=N/256>>>0;if(N!==0)throw new Error("Non-zero carry");P=Z,A++}if(b[A]!==" "){for(var q=U-P;q!==U&&$[q]===0;)q++;for(var V=new Uint8Array(I+(U-q)),Le=I;q!==U;)V[Le++]=$[q++];return V}}}function F(b){var A=m(b);if(A)return A;throw new Error(`Non-${e} character`)}return{encode:p,decodeUnsafe:m,decode:F}}var hc=fc,pc=hc,Nn=pc;var Un=class{constructor(e,t,n){this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},Rn=class{constructor(e,t,n){this.name=e,this.prefix=t,this.baseDecode=n}decode(e){if(typeof e=="string")switch(e[0]){case this.prefix:return this.baseDecode(e.slice(1));default:throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`)}else throw Error("Can only multibase decode strings")}or(e){let t={[this.prefix]:this,...e.decoders||{[e.prefix]:e}};return new lt(t)}},lt=class{constructor(e){this.decoders=e}or(e){let t=e.decoders||{[e.prefix]:e};return new lt({...this.decoders,...t})}decode(e){let t=e[0],n=this.decoders[t];if(n)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}},zn=class{constructor(e,t,n,i){this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=i,this.encoder=new Un(e,t,n),this.decoder=new Rn(e,t,i)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}},ft=({name:r,prefix:e,encode:t,decode:n})=>new zn(r,e,t,n),we=({prefix:r,name:e,alphabet:t})=>{let{encode:n,decode:i}=Nn(t,e);return ft({prefix:r,name:e,encode:n,decode:s=>de(i(s))})},dc=(r,e,t,n)=>{let i={};for(let f=0;f<e.length;++f)i[e[f]]=f;let s=r.length;for(;r[s-1]==="=";)--s;let o=new Uint8Array(s*t/8|0),a=0,c=0,l=0;for(let f=0;f<s;++f){let p=i[r[f]];if(p===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<t|p,a+=t,a>=8&&(a-=8,o[l++]=255&c>>a)}if(a>=t||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o},yc=(r,e,t)=>{let n=e[e.length-1]==="=",i=(1<<t)-1,s="",o=0,a=0;for(let c=0;c<r.length;++c)for(a=a<<8|r[c],o+=8;o>t;)o-=t,s+=e[i&a>>o];if(o&&(s+=e[i&a<<t-o]),n)for(;s.length*t&7;)s+="=";return s},T=({name:r,prefix:e,bitsPerChar:t,alphabet:n})=>ft({prefix:e,name:r,encode(i){return yc(i,n,t)},decode(i){return dc(i,n,t,r)}});var B=we({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),gc=we({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var Vt={};J(Vt,{base32:()=>Ue,base32hex:()=>_c,base32hexpad:()=>Bc,base32hexpadupper:()=>vc,base32hexupper:()=>xc,base32pad:()=>mc,base32padupper:()=>bc,base32upper:()=>wc,base32z:()=>Ec});u();var Ue=T({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),wc=T({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),mc=T({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),bc=T({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),_c=T({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),xc=T({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),Bc=T({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),vc=T({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),Ec=T({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var E=class{constructor(e,t,n,i){this.code=t,this.version=e,this.multihash=n,this.bytes=i,this.byteOffset=i.byteOffset,this.byteLength=i.byteLength,this.asCID=this,this._baseCache=new Map,Object.defineProperties(this,{byteOffset:pt,byteLength:pt,code:ht,version:ht,multihash:ht,bytes:ht,_baseCache:pt,asCID:pt})}toV0(){switch(this.version){case 0:return this;default:{let{code:e,multihash:t}=this;if(e!==Xe)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(t.code!==Cc)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return E.createV0(t)}}}toV1(){switch(this.version){case 0:{let{code:e,digest:t}=this.multihash,n=ut(e,t);return E.createV1(this.code,n)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}equals(e){return e&&this.code===e.code&&this.version===e.version&&jn(this.multihash,e.multihash)}toString(e){let{bytes:t,version:n,_baseCache:i}=this;switch(n){case 0:return Sc(t,i,e||B.encoder);default:return Ac(t,i,e||Ue.encoder)}}toJSON(){return{code:this.code,version:this.version,hash:this.multihash.bytes}}get[Symbol.toStringTag](){return"CID"}[Symbol.for("nodejs.util.inspect.custom")](){return"CID("+this.toString()+")"}static isCID(e){return Fc(/^0\.0/,Lc),!!(e&&(e[Wn]||e.asCID===e))}get toBaseEncodedString(){throw new Error("Deprecated, use .toString()")}get codec(){throw new Error('"codec" property is deprecated, use integer "code" property instead')}get buffer(){throw new Error("Deprecated .buffer property, use .bytes to get Uint8Array instead")}get multibaseName(){throw new Error('"multibaseName" property is deprecated')}get prefix(){throw new Error('"prefix" property is deprecated')}static asCID(e){if(e instanceof E)return e;if(e!=null&&e.asCID===e){let{version:t,code:n,multihash:i,bytes:s}=e;return new E(t,n,i,s||qn(t,n,i.bytes))}else if(e!=null&&e[Wn]===!0){let{version:t,multihash:n,code:i}=e,s=Pn(n);return E.create(t,i,s)}else return null}static create(e,t,n){if(typeof t!="number")throw new Error("String codecs are no longer supported");switch(e){case 0:{if(t!==Xe)throw new Error(`Version 0 CID must use dag-pb (code: ${Xe}) block encoding`);return new E(e,t,n,n.bytes)}case 1:{let i=qn(e,t,n.bytes);return new E(e,t,n,i)}default:throw new Error("Invalid version")}}static createV0(e){return E.create(0,Xe,e)}static createV1(e,t){return E.create(1,e,t)}static decode(e){let[t,n]=E.decodeFirst(e);if(n.length)throw new Error("Incorrect length");return t}static decodeFirst(e){let t=E.inspectBytes(e),n=t.size-t.multihashSize,i=de(e.subarray(n,n+t.multihashSize));if(i.byteLength!==t.multihashSize)throw new Error("Incorrect length");let s=i.subarray(t.multihashSize-t.digestSize),o=new Qe(t.multihashCode,t.digestSize,s,i);return[t.version===0?E.createV0(o):E.createV1(t.codec,o),e.subarray(t.size)]}static inspectBytes(e){let t=0,n=()=>{let[p,m]=Je(e.subarray(t));return t+=m,p},i=n(),s=Xe;if(i===18?(i=0,t=0):i===1&&(s=n()),i!==0&&i!==1)throw new RangeError(`Invalid CID version ${i}`);let o=t,a=n(),c=n(),l=t+c,f=l-o;return{version:i,codec:s,multihashCode:a,digestSize:c,multihashSize:f,size:l}}static parse(e,t){let[n,i]=kc(e,t),s=E.decode(i);return s._baseCache.set(n,e),s}},kc=(r,e)=>{switch(r[0]){case"Q":{let t=e||B;return[B.prefix,t.decode(`${B.prefix}${r}`)]}case B.prefix:{let t=e||B;return[B.prefix,t.decode(r)]}case Ue.prefix:{let t=e||Ue;return[Ue.prefix,t.decode(r)]}default:{if(e==null)throw Error("To parse non base32 or base58btc encoded CID multibase decoder must be provided");return[r[0],e.decode(r)]}}},Sc=(r,e,t)=>{let{prefix:n}=t;if(n!==B.prefix)throw Error(`Cannot string encode V0 in ${t.name} encoding`);let i=e.get(n);if(i==null){let s=t.encode(r).slice(1);return e.set(n,s),s}else return i},Ac=(r,e,t)=>{let{prefix:n}=t,i=e.get(n);if(i==null){let s=t.encode(r);return e.set(n,s),s}else return i},Xe=112,Cc=18,qn=(r,e,t)=>{let n=Ne(r),i=n+Ne(e),s=new Uint8Array(i+t.byteLength);return De(r,s,0),De(e,s,n),s.set(t,i),s},Wn=Symbol.for("@ipld/js-cid/CID"),ht={writable:!1,configurable:!1,enumerable:!0},pt={writable:!1,enumerable:!1,configurable:!1},Tc="0.0.0-dev",Fc=(r,e)=>{if(r.test(Tc))console.warn(e);else throw new Error(e)},Lc=`CID.isCID(v) is deprecated and will be removed in the next major release.
Following code pattern:

if (CID.isCID(value)) {
  doSomethingWithCID(value)
}

Is replaced with:

const cid = CID.asCID(value)
if (cid) {
  // Make sure to use cid instead of value
  doSomethingWithCID(cid)
}
`;var Jt={};J(Jt,{sha256:()=>Ze,sha512:()=>Oc});u();u();var Ke=({name:r,code:e,encode:t})=>new Hn(r,e,t),Hn=class{constructor(e,t,n){this.name=e,this.code=t,this.encode=n}async digest(e){if(e instanceof Uint8Array){let t=await this.encode(e);return ut(this.code,t)}else throw Error("Unknown type, must be binary type")}};var Gn=r=>async e=>new Uint8Array(await crypto.subtle.digest(r,e)),Ze=Ke({name:"sha2-256",code:18,encode:Gn("SHA-256")}),Oc=Ke({name:"sha2-512",code:19,encode:Gn("SHA-512")});var Es=L(oi());u();var Ye=L(dt());function su(r){let e=new Uint8Array(r.reduce((n,i)=>n+Ye.default.encodingLength(i),0)),t=0;for(let n of r)e=Ye.encode(n,e,t),t+=Ye.default.encodingLength(n);return e}var gi=su;u();var fr=L(xi());u();function Bi(r,e){if(r===e)return!0;if(r.byteLength!==e.byteLength)return!1;for(let t=0;t<r.byteLength;t++)if(r[t]!==e[t])return!1;return!0}u();u();u();var wt=class{constructor(e,t,n){this._refCounter=1,this.cid=e,this.priority=t||1,this.wantType=n}inc(){this._refCounter+=1}dec(){this._refCounter=Math.max(0,this._refCounter-1)}hasRefs(){return this._refCounter>0}get[Symbol.toStringTag](){return`WantlistEntry <key: ${this.cid.toString(B)}, priority: ${this.priority}, refs: ${this._refCounter}>`}equals(e){return this._refCounter===e._refCounter&&this.cid.equals(e.cid)&&this.priority===e.priority&&this.wantType===e.wantType}};u();var te=L(bs()),ue=te.default.Reader,nt=te.default.Writer,v=te.default.util,_=te.default.roots["ipfs-bitswap"]||(te.default.roots["ipfs-bitswap"]={}),H=_.Message=(()=>{function r(e){if(this.blocks=[],this.payload=[],this.blockPresences=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)e[t[n]]!=null&&(this[t[n]]=e[t[n]])}return r.prototype.wantlist=null,r.prototype.blocks=v.emptyArray,r.prototype.payload=v.emptyArray,r.prototype.blockPresences=v.emptyArray,r.prototype.pendingBytes=0,r.encode=function(t,n){if(n||(n=nt.create()),t.wantlist!=null&&Object.hasOwnProperty.call(t,"wantlist")&&_.Message.Wantlist.encode(t.wantlist,n.uint32(10).fork()).ldelim(),t.blocks!=null&&t.blocks.length)for(var i=0;i<t.blocks.length;++i)n.uint32(18).bytes(t.blocks[i]);if(t.payload!=null&&t.payload.length)for(var i=0;i<t.payload.length;++i)_.Message.Block.encode(t.payload[i],n.uint32(26).fork()).ldelim();if(t.blockPresences!=null&&t.blockPresences.length)for(var i=0;i<t.blockPresences.length;++i)_.Message.BlockPresence.encode(t.blockPresences[i],n.uint32(34).fork()).ldelim();return t.pendingBytes!=null&&Object.hasOwnProperty.call(t,"pendingBytes")&&n.uint32(40).int32(t.pendingBytes),n},r.decode=function(t,n){t instanceof ue||(t=ue.create(t));for(var i=n===void 0?t.len:t.pos+n,s=new _.Message;t.pos<i;){var o=t.uint32();switch(o>>>3){case 1:s.wantlist=_.Message.Wantlist.decode(t,t.uint32());break;case 2:s.blocks&&s.blocks.length||(s.blocks=[]),s.blocks.push(t.bytes());break;case 3:s.payload&&s.payload.length||(s.payload=[]),s.payload.push(_.Message.Block.decode(t,t.uint32()));break;case 4:s.blockPresences&&s.blockPresences.length||(s.blockPresences=[]),s.blockPresences.push(_.Message.BlockPresence.decode(t,t.uint32()));break;case 5:s.pendingBytes=t.int32();break;default:t.skipType(o&7);break}}return s},r.fromObject=function(t){if(t instanceof _.Message)return t;var n=new _.Message;if(t.wantlist!=null){if(typeof t.wantlist!="object")throw TypeError(".Message.wantlist: object expected");n.wantlist=_.Message.Wantlist.fromObject(t.wantlist)}if(t.blocks){if(!Array.isArray(t.blocks))throw TypeError(".Message.blocks: array expected");n.blocks=[];for(var i=0;i<t.blocks.length;++i)typeof t.blocks[i]=="string"?v.base64.decode(t.blocks[i],n.blocks[i]=v.newBuffer(v.base64.length(t.blocks[i])),0):t.blocks[i].length&&(n.blocks[i]=t.blocks[i])}if(t.payload){if(!Array.isArray(t.payload))throw TypeError(".Message.payload: array expected");n.payload=[];for(var i=0;i<t.payload.length;++i){if(typeof t.payload[i]!="object")throw TypeError(".Message.payload: object expected");n.payload[i]=_.Message.Block.fromObject(t.payload[i])}}if(t.blockPresences){if(!Array.isArray(t.blockPresences))throw TypeError(".Message.blockPresences: array expected");n.blockPresences=[];for(var i=0;i<t.blockPresences.length;++i){if(typeof t.blockPresences[i]!="object")throw TypeError(".Message.blockPresences: object expected");n.blockPresences[i]=_.Message.BlockPresence.fromObject(t.blockPresences[i])}}return t.pendingBytes!=null&&(n.pendingBytes=t.pendingBytes|0),n},r.toObject=function(t,n){n||(n={});var i={};if((n.arrays||n.defaults)&&(i.blocks=[],i.payload=[],i.blockPresences=[]),n.defaults&&(i.wantlist=null,i.pendingBytes=0),t.wantlist!=null&&t.hasOwnProperty("wantlist")&&(i.wantlist=_.Message.Wantlist.toObject(t.wantlist,n)),t.blocks&&t.blocks.length){i.blocks=[];for(var s=0;s<t.blocks.length;++s)i.blocks[s]=n.bytes===String?v.base64.encode(t.blocks[s],0,t.blocks[s].length):n.bytes===Array?Array.prototype.slice.call(t.blocks[s]):t.blocks[s]}if(t.payload&&t.payload.length){i.payload=[];for(var s=0;s<t.payload.length;++s)i.payload[s]=_.Message.Block.toObject(t.payload[s],n)}if(t.blockPresences&&t.blockPresences.length){i.blockPresences=[];for(var s=0;s<t.blockPresences.length;++s)i.blockPresences[s]=_.Message.BlockPresence.toObject(t.blockPresences[s],n)}return t.pendingBytes!=null&&t.hasOwnProperty("pendingBytes")&&(i.pendingBytes=t.pendingBytes),i},r.prototype.toJSON=function(){return this.constructor.toObject(this,te.default.util.toJSONOptions)},r.Wantlist=function(){function e(t){if(this.entries=[],t)for(var n=Object.keys(t),i=0;i<n.length;++i)t[n[i]]!=null&&(this[n[i]]=t[n[i]])}return e.prototype.entries=v.emptyArray,e.prototype.full=!1,e.encode=function(n,i){if(i||(i=nt.create()),n.entries!=null&&n.entries.length)for(var s=0;s<n.entries.length;++s)_.Message.Wantlist.Entry.encode(n.entries[s],i.uint32(10).fork()).ldelim();return n.full!=null&&Object.hasOwnProperty.call(n,"full")&&i.uint32(16).bool(n.full),i},e.decode=function(n,i){n instanceof ue||(n=ue.create(n));for(var s=i===void 0?n.len:n.pos+i,o=new _.Message.Wantlist;n.pos<s;){var a=n.uint32();switch(a>>>3){case 1:o.entries&&o.entries.length||(o.entries=[]),o.entries.push(_.Message.Wantlist.Entry.decode(n,n.uint32()));break;case 2:o.full=n.bool();break;default:n.skipType(a&7);break}}return o},e.fromObject=function(n){if(n instanceof _.Message.Wantlist)return n;var i=new _.Message.Wantlist;if(n.entries){if(!Array.isArray(n.entries))throw TypeError(".Message.Wantlist.entries: array expected");i.entries=[];for(var s=0;s<n.entries.length;++s){if(typeof n.entries[s]!="object")throw TypeError(".Message.Wantlist.entries: object expected");i.entries[s]=_.Message.Wantlist.Entry.fromObject(n.entries[s])}}return n.full!=null&&(i.full=Boolean(n.full)),i},e.toObject=function(n,i){i||(i={});var s={};if((i.arrays||i.defaults)&&(s.entries=[]),i.defaults&&(s.full=!1),n.entries&&n.entries.length){s.entries=[];for(var o=0;o<n.entries.length;++o)s.entries[o]=_.Message.Wantlist.Entry.toObject(n.entries[o],i)}return n.full!=null&&n.hasOwnProperty("full")&&(s.full=n.full),s},e.prototype.toJSON=function(){return this.constructor.toObject(this,te.default.util.toJSONOptions)},e.WantType=function(){let t={},n=Object.create(t);return n[t[0]="Block"]=0,n[t[1]="Have"]=1,n}(),e.Entry=function(){function t(n){if(n)for(var i=Object.keys(n),s=0;s<i.length;++s)n[i[s]]!=null&&(this[i[s]]=n[i[s]])}return t.prototype.block=v.newBuffer([]),t.prototype.priority=0,t.prototype.cancel=!1,t.prototype.wantType=0,t.prototype.sendDontHave=!1,t.encode=function(i,s){return s||(s=nt.create()),i.block!=null&&Object.hasOwnProperty.call(i,"block")&&s.uint32(10).bytes(i.block),i.priority!=null&&Object.hasOwnProperty.call(i,"priority")&&s.uint32(16).int32(i.priority),i.cancel!=null&&Object.hasOwnProperty.call(i,"cancel")&&s.uint32(24).bool(i.cancel),i.wantType!=null&&Object.hasOwnProperty.call(i,"wantType")&&s.uint32(32).int32(i.wantType),i.sendDontHave!=null&&Object.hasOwnProperty.call(i,"sendDontHave")&&s.uint32(40).bool(i.sendDontHave),s},t.decode=function(i,s){i instanceof ue||(i=ue.create(i));for(var o=s===void 0?i.len:i.pos+s,a=new _.Message.Wantlist.Entry;i.pos<o;){var c=i.uint32();switch(c>>>3){case 1:a.block=i.bytes();break;case 2:a.priority=i.int32();break;case 3:a.cancel=i.bool();break;case 4:a.wantType=i.int32();break;case 5:a.sendDontHave=i.bool();break;default:i.skipType(c&7);break}}return a},t.fromObject=function(i){if(i instanceof _.Message.Wantlist.Entry)return i;var s=new _.Message.Wantlist.Entry;switch(i.block!=null&&(typeof i.block=="string"?v.base64.decode(i.block,s.block=v.newBuffer(v.base64.length(i.block)),0):i.block.length&&(s.block=i.block)),i.priority!=null&&(s.priority=i.priority|0),i.cancel!=null&&(s.cancel=Boolean(i.cancel)),i.wantType){case"Block":case 0:s.wantType=0;break;case"Have":case 1:s.wantType=1;break}return i.sendDontHave!=null&&(s.sendDontHave=Boolean(i.sendDontHave)),s},t.toObject=function(i,s){s||(s={});var o={};return s.defaults&&(s.bytes===String?o.block="":(o.block=[],s.bytes!==Array&&(o.block=v.newBuffer(o.block))),o.priority=0,o.cancel=!1,o.wantType=s.enums===String?"Block":0,o.sendDontHave=!1),i.block!=null&&i.hasOwnProperty("block")&&(o.block=s.bytes===String?v.base64.encode(i.block,0,i.block.length):s.bytes===Array?Array.prototype.slice.call(i.block):i.block),i.priority!=null&&i.hasOwnProperty("priority")&&(o.priority=i.priority),i.cancel!=null&&i.hasOwnProperty("cancel")&&(o.cancel=i.cancel),i.wantType!=null&&i.hasOwnProperty("wantType")&&(o.wantType=s.enums===String?_.Message.Wantlist.WantType[i.wantType]:i.wantType),i.sendDontHave!=null&&i.hasOwnProperty("sendDontHave")&&(o.sendDontHave=i.sendDontHave),o},t.prototype.toJSON=function(){return this.constructor.toObject(this,te.default.util.toJSONOptions)},t}(),e}(),r.Block=function(){function e(t){if(t)for(var n=Object.keys(t),i=0;i<n.length;++i)t[n[i]]!=null&&(this[n[i]]=t[n[i]])}return e.prototype.prefix=v.newBuffer([]),e.prototype.data=v.newBuffer([]),e.encode=function(n,i){return i||(i=nt.create()),n.prefix!=null&&Object.hasOwnProperty.call(n,"prefix")&&i.uint32(10).bytes(n.prefix),n.data!=null&&Object.hasOwnProperty.call(n,"data")&&i.uint32(18).bytes(n.data),i},e.decode=function(n,i){n instanceof ue||(n=ue.create(n));for(var s=i===void 0?n.len:n.pos+i,o=new _.Message.Block;n.pos<s;){var a=n.uint32();switch(a>>>3){case 1:o.prefix=n.bytes();break;case 2:o.data=n.bytes();break;default:n.skipType(a&7);break}}return o},e.fromObject=function(n){if(n instanceof _.Message.Block)return n;var i=new _.Message.Block;return n.prefix!=null&&(typeof n.prefix=="string"?v.base64.decode(n.prefix,i.prefix=v.newBuffer(v.base64.length(n.prefix)),0):n.prefix.length&&(i.prefix=n.prefix)),n.data!=null&&(typeof n.data=="string"?v.base64.decode(n.data,i.data=v.newBuffer(v.base64.length(n.data)),0):n.data.length&&(i.data=n.data)),i},e.toObject=function(n,i){i||(i={});var s={};return i.defaults&&(i.bytes===String?s.prefix="":(s.prefix=[],i.bytes!==Array&&(s.prefix=v.newBuffer(s.prefix))),i.bytes===String?s.data="":(s.data=[],i.bytes!==Array&&(s.data=v.newBuffer(s.data)))),n.prefix!=null&&n.hasOwnProperty("prefix")&&(s.prefix=i.bytes===String?v.base64.encode(n.prefix,0,n.prefix.length):i.bytes===Array?Array.prototype.slice.call(n.prefix):n.prefix),n.data!=null&&n.hasOwnProperty("data")&&(s.data=i.bytes===String?v.base64.encode(n.data,0,n.data.length):i.bytes===Array?Array.prototype.slice.call(n.data):n.data),s},e.prototype.toJSON=function(){return this.constructor.toObject(this,te.default.util.toJSONOptions)},e}(),r.BlockPresenceType=function(){let e={},t=Object.create(e);return t[e[0]="Have"]=0,t[e[1]="DontHave"]=1,t}(),r.BlockPresence=function(){function e(t){if(t)for(var n=Object.keys(t),i=0;i<n.length;++i)t[n[i]]!=null&&(this[n[i]]=t[n[i]])}return e.prototype.cid=v.newBuffer([]),e.prototype.type=0,e.encode=function(n,i){return i||(i=nt.create()),n.cid!=null&&Object.hasOwnProperty.call(n,"cid")&&i.uint32(10).bytes(n.cid),n.type!=null&&Object.hasOwnProperty.call(n,"type")&&i.uint32(16).int32(n.type),i},e.decode=function(n,i){n instanceof ue||(n=ue.create(n));for(var s=i===void 0?n.len:n.pos+i,o=new _.Message.BlockPresence;n.pos<s;){var a=n.uint32();switch(a>>>3){case 1:o.cid=n.bytes();break;case 2:o.type=n.int32();break;default:n.skipType(a&7);break}}return o},e.fromObject=function(n){if(n instanceof _.Message.BlockPresence)return n;var i=new _.Message.BlockPresence;switch(n.cid!=null&&(typeof n.cid=="string"?v.base64.decode(n.cid,i.cid=v.newBuffer(v.base64.length(n.cid)),0):n.cid.length&&(i.cid=n.cid)),n.type){case"Have":case 0:i.type=0;break;case"DontHave":case 1:i.type=1;break}return i},e.toObject=function(n,i){i||(i={});var s={};return i.defaults&&(i.bytes===String?s.cid="":(s.cid=[],i.bytes!==Array&&(s.cid=v.newBuffer(s.cid))),s.type=i.enums===String?"Have":0),n.cid!=null&&n.hasOwnProperty("cid")&&(s.cid=i.bytes===String?v.base64.encode(n.cid,0,n.cid.length):i.bytes===Array?Array.prototype.slice.call(n.cid):n.cid),n.type!=null&&n.hasOwnProperty("type")&&(s.type=i.enums===String?_.Message.BlockPresenceType[n.type]:n.type),s},e.prototype.toJSON=function(){return this.constructor.toObject(this,te.default.util.toJSONOptions)},e}(),r})();var _s={Block:H.Wantlist.WantType.Block,Have:H.Wantlist.WantType.Have},Au=(r,e)=>Array.prototype.slice.call(e,0).sort((t,n)=>{let i=r(t),s=r(n);return i<s?-1:i>s?1:0}),le=class{constructor(e){this.set=new Map,this._stats=e}get length(){return this.set.size}add(e,t,n){let i=e.toString(B),s=this.set.get(i);s?(s.inc(),s.priority=t,s.wantType===_s.Have&&n===_s.Block&&(s.wantType=n)):(this.set.set(i,new wt(e,t,n)),this._stats&&this._stats.push(null,"wantListSize",1))}remove(e){let t=e.toString(B),n=this.set.get(t);!n||(n.dec(),!n.hasRefs()&&(this.set.delete(t),this._stats&&this._stats.push(null,"wantListSize",-1)))}removeForce(e){this.set.has(e)&&this.set.delete(e)}forEach(e){return this.set.forEach(e)}entries(){return this.set.entries()}sortedEntries(){return new Map(Au(e=>e[1].key,Array.from(this.set.entries())))}contains(e){let t=e.toString(B);return this.set.has(t)}get(e){let t=e.toString(B);return this.set.get(t)}};le.Entry=wt;var Cu=le.Entry,Ce=class{constructor(e,t,n,i,s){this.entry=new Cu(e,t,n),this.cancel=Boolean(i),this.sendDontHave=Boolean(s)}get cid(){return this.entry.cid}set cid(e){this.entry.cid=e}get priority(){return this.entry.priority}set priority(e){this.entry.priority=e}get wantType(){return this.entry.wantType}set wantType(e){this.entry.wantType=e}get[Symbol.toStringTag](){return`BitswapMessageEntry ${this.cid.toString(B)} <cancel: ${this.cancel}, priority: ${this.priority}>`}equals(e){return this.cancel===e.cancel&&this.sendDontHave===e.sendDontHave&&this.wantType===e.wantType&&this.entry.equals(e.entry)}};var K=(r,e)=>{let t=["bitswap"];return e&&t.push(e),r&&t.push(`${r.toB58String().slice(0,8)}`),Object.assign((0,fr.default)(t.join(":")),{error:(0,fr.default)(t.concat(["error"]).join(":"))})};var Bt=(r,e)=>{if(r.size!==e.size)return!1;for(let[t,n]of r){let i=e.get(t);if(i===void 0||n instanceof Uint8Array&&i instanceof Uint8Array&&!Bi(n,i)||n instanceof Ce&&i instanceof Ce&&!n.equals(i))return!1}return!0};var ks=L(vs()),k=class{constructor(e){this.full=e,this.wantlist=new Map,this.blocks=new Map,this.blockPresences=new Map,this.pendingBytes=0}get empty(){return this.blocks.size===0&&this.wantlist.size===0&&this.blockPresences.size===0}addEntry(e,t,n,i,s){n==null&&(n=k.WantType.Block);let o=e.toString(B),a=this.wantlist.get(o);a?(a.wantType===n&&(a.priority=t),i&&(a.cancel=Boolean(i)),s&&(a.sendDontHave=Boolean(s)),n===k.WantType.Block&&a.wantType===k.WantType.Have&&(a.wantType=n)):this.wantlist.set(o,new Ce(e,t,n,i,s))}addBlock(e,t){let n=e.toString(B);this.blocks.set(n,t)}addHave(e){let t=e.toString(B);this.blockPresences.has(t)||this.blockPresences.set(t,k.BlockPresenceType.Have)}addDontHave(e){let t=e.toString(B);this.blockPresences.has(t)||this.blockPresences.set(t,k.BlockPresenceType.DontHave)}cancel(e){let t=e.toString(B);this.wantlist.delete(t),this.addEntry(e,0,k.WantType.Block,!0,!1)}setPendingBytes(e){this.pendingBytes=e}serializeToBitswap100(){let e={wantlist:{entries:Array.from(this.wantlist.values()).map(t=>({block:t.cid.bytes,priority:Number(t.priority),cancel:Boolean(t.cancel)})),full:this.full?!0:void 0},blocks:Array.from(this.blocks.values())};return H.encode(e).finish()}serializeToBitswap110(){let e={wantlist:{entries:Array.from(this.wantlist.values()).map(t=>({block:t.cid.bytes,priority:Number(t.priority),wantType:t.wantType,cancel:Boolean(t.cancel),sendDontHave:Boolean(t.sendDontHave)})),full:this.full?!0:void 0},blockPresences:[],payload:[],pendingBytes:this.pendingBytes};for(let[t,n]of this.blocks.entries()){let i=E.parse(t),s=i.version,o=i.code,a=i.multihash.code,c=i.multihash.digest.length,l=gi([s,o,a,c]);e.payload.push(new H.Block({prefix:l,data:n}))}for(let[t,n]of this.blockPresences)e.blockPresences.push(new H.BlockPresence({cid:E.parse(t).bytes,type:n}));return this.pendingBytes>0&&(e.pendingBytes=this.pendingBytes),H.encode(e).finish()}equals(e){return!(this.full!==e.full||this.pendingBytes!==e.pendingBytes||!Bt(this.wantlist,e.wantlist)||!Bt(this.blocks,e.blocks)||!Bt(this.blockPresences,e.blockPresences))}get[Symbol.toStringTag](){let e=Array.from(this.wantlist.keys()),t=Array.from(this.blocks.keys());return`BitswapMessage <full: ${this.full}, list: ${e}, blocks: ${t}>`}};k.deserialize=async(r,e)=>{let t=H.decode(r),n=t.wantlist&&t.wantlist.full||!1,i=new k(n);return t.wantlist&&t.wantlist.entries&&t.wantlist.entries.forEach(s=>{if(!s.block)return;let o=E.decode(s.block);i.addEntry(o,s.priority||0,s.wantType,Boolean(s.cancel),Boolean(s.sendDontHave))}),t.blockPresences&&t.blockPresences.forEach(s=>{if(!s.cid)return;let o=E.decode(s.cid);s.type===k.BlockPresenceType.Have?i.addHave(o):i.addDontHave(o)}),t.blocks.length>0?(await Promise.all(t.blocks.map(async s=>{let o=await Ze.digest(s),a=E.createV0(o);i.addBlock(a,s)})),i):(t.payload.length>0&&(await Promise.all(t.payload.map(async s=>{if(!s.prefix||!s.data)return;let o=(0,Es.default)(s.prefix),a=o[0],c=o[1],l=o[2],f=l===Ze.code?Ze:e&&await e.getHasher(l);if(!f)throw(0,ks.default)(new Error("Unknown hash algorithm"),"ERR_UNKNOWN_HASH_ALG");let p=await f.digest(s.data),m=E.create(a,c,p);i.addBlock(m,s.data)})),i.setPendingBytes(t.pendingBytes)),i)};k.blockPresenceSize=r=>r.bytes.length+1;k.Entry=Ce;k.WantType={Block:H.Wantlist.WantType.Block,Have:H.Wantlist.WantType.Have};k.BlockPresenceType={Have:H.BlockPresenceType.Have,DontHave:H.BlockPresenceType.DontHave};u();var hr=1e3,Ss=3,As=10*hr,Jf=15*hr,Qf=15*hr,Cs=Math.pow(2,31)-1,Ts=1e3,Fs=1;u();var Ms=L(Os());var pr=class{constructor(e,t,n){this.peerId=t,this.network=n,this.refcnt=1,this._entries=[],this._log=K(e,"msgqueue"),this.sendEntries=(0,Ms.default)(this._sendEntries.bind(this),Fs)}addMessage(e){e.empty||this.send(e)}addEntries(e){this._entries=this._entries.concat(e),this.sendEntries()}_sendEntries(){if(!this._entries.length)return;let e=new k(!1);this._entries.forEach(t=>{t.cancel?e.cancel(t.cid):e.addEntry(t.cid,t.priority)}),this._entries=[],this.addMessage(e)}async send(e){try{await this.network.connectTo(this.peerId)}catch(t){this._log.error("cant connect to peer %s: %s",this.peerId.toB58String(),t.message);return}this._log("sending message to peer %s",this.peerId.toB58String()),this.network.sendMessage(this.peerId,e).catch(t=>{this._log.error("send error: %s",t.message)})}};var dr=class{constructor(e,t,n){this.peers=new Map,this.wantlist=new le(n),this.network=t,this._stats=n,this._peerId=e,this._log=K(e,"want")}_addEntries(e,t,n){let i=e.map((s,o)=>new k.Entry(s,Cs-o,k.WantType.Block,t));i.forEach(s=>{s.cancel?n?this.wantlist.removeForce(s.cid.toString(B)):this.wantlist.remove(s.cid):(this._log("adding to wl"),this.wantlist.add(s.cid,s.priority))});for(let s of this.peers.values())s.addEntries(i)}_startPeerHandler(e){let t=this.peers.get(e.toB58String());if(t){t.refcnt++;return}t=new pr(this._peerId,e,this.network);let n=new k(!0);for(let i of this.wantlist.entries())n.addEntry(i[1].cid,i[1].priority);return t.addMessage(n),this.peers.set(e.toB58String(),t),t}_stopPeerHandler(e){let t=this.peers.get(e.toB58String());!t||(t.refcnt--,!(t.refcnt>0)&&this.peers.delete(e.toB58String()))}wantBlocks(e,t={}){this._addEntries(e,!1),t&&t.signal&&t.signal.addEventListener("abort",()=>{this.cancelWants(e)})}unwantBlocks(e){this._log("unwant blocks: %s",e.length),this._addEntries(e,!0,!0)}cancelWants(e){this._log("cancel wants: %s",e.length),this._addEntries(e,!0)}connectedPeers(){return Array.from(this.peers.keys())}connected(e){this._startPeerHandler(e)}disconnected(e){this._stopPeerHandler(e)}start(){}stop(){this.peers.forEach(e=>this.disconnected(e.peerId))}};u();var Br=L(io()),vr=L(ao()),mo=L(wo());var Er="/ipfs/bitswap/1.0.0",kr="/ipfs/bitswap/1.1.0",Sr="/ipfs/bitswap/1.2.0",Ar=class{constructor(e,t,n,i={}){this._log=K(e.peerId,"network"),this._libp2p=e,this._bitswap=t,this._protocols=[Er],i.b100Only||(this._protocols.unshift(kr),this._protocols.unshift(Sr)),this._stats=n,this._running=!1,this._onPeerConnect=this._onPeerConnect.bind(this),this._onPeerDisconnect=this._onPeerDisconnect.bind(this),this._onConnection=this._onConnection.bind(this),this._hashLoader=i.hashLoader}start(){this._running=!0,this._libp2p.handle(this._protocols,this._onConnection);let e=new mo.default({multicodecs:this._protocols,handlers:{onConnect:this._onPeerConnect,onDisconnect:this._onPeerDisconnect}});this._registrarId=this._libp2p.registrar.register(e);for(let t of this._libp2p.peerStore.peers.values()){let n=this._libp2p.connectionManager.get(t.id);n&&this._onPeerConnect(n.remotePeer)}}stop(){this._running=!1,this._libp2p.unhandle(this._protocols),this._registrarId!=null&&this._libp2p.registrar.unregister(this._registrarId)}async _onConnection({protocol:e,stream:t,connection:n}){if(!!this._running){this._log("incoming new bitswap %s connection from %s",e,n.remotePeer.toB58String());try{await(0,vr.pipe)(t,Br.default.decode(),async i=>{for await(let s of i)try{let o=await k.deserialize(s.slice(),this._hashLoader);await this._bitswap._receiveMessage(n.remotePeer,o)}catch(o){this._bitswap._receiveError(o);break}})}catch(i){this._log(i)}}}_onPeerConnect(e){this._bitswap._onPeerConnected(e)}_onPeerDisconnect(e){this._bitswap._onPeerDisconnected(e)}findProviders(e,t,n={}){return this._libp2p.contentRouting.findProviders(e,{timeout:As,maxNumProviders:t})}async findAndConnect(e,t){let n=[];for await(let i of this.findProviders(e,Ss,t))this._log(`connecting to provider ${i.id}`),n.push(this.connectTo(i.id,t).catch(s=>{this._log.error(s)}));await Promise.all(n)}async provide(e,t){await this._libp2p.contentRouting.provide(e,t)}async sendMessage(e,t){if(!this._running)throw new Error("network isn't running");let n=e.toB58String();this._log("sendMessage to %s",n,t);let i=await this._libp2p.dial(e),{stream:s,protocol:o}=await i.newStream([Sr,kr,Er]),a;switch(o){case Er:a=t.serializeToBitswap100();break;case kr:case Sr:a=t.serializeToBitswap110();break;default:throw new Error("Unknown protocol: "+o)}Ru(s,a,this._log),this._updateSentStats(e,t.blocks)}async connectTo(e,t){if(!this._running)throw new Error("network isn't running");return this._libp2p.dial(e,t)}_updateSentStats(e,t){let n=e.toB58String();if(this._stats){for(let i of t.values())this._stats.push(n,"dataSent",i.length);this._stats.push(n,"blocksSent",t.size)}}};async function Ru(r,e,t){try{await(0,vr.pipe)([e],Br.default.encode(),r)}catch(n){t(n)}}u();u();var Cr=class{constructor(e){this.partner=e,this.wantlist=new le,this.exchangeCount=0,this.sentToPeer=new Map,this.accounting={bytesSent:0,bytesRecv:0}}sentBytes(e){this.exchangeCount++,this.lastExchange=new Date().getTime(),this.accounting.bytesSent+=e}receivedBytes(e){this.exchangeCount++,this.lastExchange=new Date().getTime(),this.accounting.bytesRecv+=e}wants(e,t,n){this.wantlist.add(e,t,n)}cancelWant(e){this.wantlist.remove(e)}wantlistContains(e){return this.wantlist.get(e)}debtRatio(){return this.accounting.bytesSent/(this.accounting.bytesRecv+1)}};u();u();var St=class extends Map{constructor(e,t){super();this._cmp=t||this._defaultSort,this._keys=[];for(let[n,i]of e||[])this.set(n,i)}update(e){if(e<0||e>=this._keys.length)return;let t=this._keys[e];this._keys.splice(e,1);let n=this._find(t);this._keys.splice(n,0,t)}set(e,t){if(this.has(e)){let i=this.indexOf(e);this._keys.splice(i,1)}super.set(e,t);let n=this._find(e);return this._keys.splice(n,0,e),this}clear(){super.clear(),this._keys=[]}delete(e){if(!this.has(e))return!1;let t=this.indexOf(e);return this._keys.splice(t,1),super.delete(e)}indexOf(e){if(!this.has(e))return-1;let t=this._find(e);if(this._keys[t]===e)return t;for(let n=1;n<this._keys.length;n++){if(this._keys[t+n]===e)return t+n;if(this._keys[t-n]===e)return t-n}return-1}_find(e){let t=0,n=this._keys.length;for(;t<n;){let i=t+n>>>1,s=this._kCmp(this._keys[i],e);if(s<0)t=i+1;else if(s>0)n=i;else return i}return t}*keys(){for(let e of this._keys)yield e}*values(){for(let e of this._keys)yield this.get(e)}*entries(){for(let e of this._keys)yield[e,this.get(e)]}*[Symbol.iterator](){yield*this.entries()}forEach(e,t){if(!!e)for(let n of this._keys)e.apply(t,[[n,this.get(n)]])}_defaultSort(e,t){return e[0]<t[0]?-1:t[0]<e[0]?1:0}_kCmp(e,t){return this._cmp([e,this.get(e)],[t,this.get(t)])}};var zu={hasNewInfo(){return!1},merge(){}},Tr=class{constructor(e=zu){this._taskMerger=e,this._byPeer=new St([],Fr.compare)}pushTasks(e,t){let n=this._byPeer.get(e.toB58String());n||(n=new Fr(e,this._taskMerger)),n.pushTasks(t),this._byPeer.set(e.toB58String(),n)}popTasks(e){let t=this._head();if(t===void 0)return{tasks:[],pendingSize:0};let{tasks:n,pendingSize:i}=t.popTasks(e);if(n.length===0)return{tasks:n,pendingSize:i};let s=t.peerId;return t.isIdle()?this._byPeer.delete(s.toB58String()):this._byPeer.update(0),{peerId:s,tasks:n,pendingSize:i}}_head(){if(this._byPeer.size!==0)for(let[,e]of this._byPeer)return e}remove(e,t){let n=this._byPeer.get(t.toB58String());n&&n.remove(e)}tasksDone(e,t){let n=this._byPeer.get(e.toB58String());if(!n)return;let i=this._byPeer.indexOf(e.toB58String());for(let s of t)n.taskDone(s);this._byPeer.update(i)}},Fr=class{constructor(e,t){this.peerId=e,this._taskMerger=t,this._activeTotalSize=0,this._pending=new bo,this._active=new Set}pushTasks(e){for(let t of e)this._pushTask(t)}_pushTask(e){if(!this._taskHasMoreInfoThanActiveTasks(e))return;let t=this._pending.get(e.topic);if(t){e.priority>t.priority&&this._pending.updatePriority(e.topic,e.priority),this._taskMerger.merge(e,t);return}this._pending.add(e)}_taskHasMoreInfoThanActiveTasks(e){let t=[];for(let n of this._active)n.topic===e.topic&&t.push(n);return t.length===0?!0:this._taskMerger.hasNewInfo(e,t)}popTasks(e){let t=0,n=[],i=this._pending.tasks();for(let s=0;s<i.length&&t<e;s++){let o=i[s];n.push(o),t+=o.size,this._pending.delete(o.topic),this._activeTotalSize+=o.size,this._active.add(o)}return{tasks:n,pendingSize:this._pending.totalSize}}taskDone(e){this._active.has(e)&&(this._activeTotalSize-=e.size,this._active.delete(e))}remove(e){this._pending.delete(e)}isIdle(){return this._pending.length===0&&this._active.size===0}static compare(e,t){return e[1]._pending.length===0?1:t[1]._pending.length===0?-1:e[1]._activeTotalSize===t[1]._activeTotalSize?t[1]._pending.length-e[1]._pending.length:e[1]._activeTotalSize-t[1]._activeTotalSize}},bo=class{constructor(){this._tasks=new St([],this._compare)}get length(){return this._tasks.size}get totalSize(){return[...this._tasks.values()].reduce((e,t)=>e+t.task.size,0)}get(e){return(this._tasks.get(e)||{}).task}add(e){this._tasks.set(e.topic,{created:Date.now(),task:e})}delete(e){this._tasks.delete(e)}tasks(){return[...this._tasks.values()].map(e=>e.task)}updatePriority(e,t){let n=this._tasks.get(e);if(!n)return;let i=this._tasks.indexOf(e);n.task.priority=t,this._tasks.update(i)}_compare(e,t){return e[1].task.priority===t[1].task.priority?e[1].created-t[1].created:t[1].task.priority-e[1].task.priority}};u();var _o={hasNewInfo(r,e){let t=!1,n=!1;for(let i of e)i.data.haveBlock&&(t=!0),i.data.isWantBlock&&(n=!0);return!!(!n&&r.data.isWantBlock||!t&&r.data.haveBlock)},merge(r,e){let t=r.data,n=e.data;!n.haveBlock&&t.haveBlock&&(n.haveBlock=t.haveBlock,n.blockSize=t.blockSize),!n.isWantBlock&&t.isWantBlock&&(n.isWantBlock=!0,(!n.haveBlock||t.haveBlock)&&(n.haveBlock=t.haveBlock,e.size=r.size)),n.isWantBlock&&n.haveBlock&&(e.size=n.blockSize)}};var xo=k.WantType,qu=16*1024,Wu=1024,Lr=class{constructor(e,t,n,i,s={}){this._log=K(e,"engine"),this.blockstore=t,this.network=n,this._stats=i,this._opts=this._processOpts(s),this.ledgerMap=new Map,this._running=!1,this._requestQueue=new Tr(_o)}_processOpts(e){return{maxSizeReplaceHasWithBlock:Wu,targetMessageSize:qu,...e}}_scheduleProcessTasks(){setTimeout(()=>{this._processTasks()})}async _processTasks(){if(!this._running)return;let{peerId:e,tasks:t,pendingSize:n}=this._requestQueue.popTasks(this._opts.targetMessageSize);if(t.length===0)return;let i=new k(!1);i.setPendingBytes(n);let s=[],o=new Map;for(let c of t){let l=E.parse(c.topic);c.data.haveBlock?c.data.isWantBlock?(s.push(l),o.set(c.topic,c.data)):i.addHave(l):i.addDontHave(l)}let a=await this._getBlocks(s);for(let[c,l]of o){let f=E.parse(c),p=a.get(c);p?i.addBlock(f,p):l.sendDontHave&&i.addDontHave(f)}if(i.empty){e&&this._requestQueue.tasksDone(e,t),this._scheduleProcessTasks();return}try{e&&await this.network.sendMessage(e,i);for(let[c,l]of a.entries())e&&this.messageSent(e,E.parse(c),l)}catch(c){this._log.error(c)}e&&this._requestQueue.tasksDone(e,t),this._scheduleProcessTasks()}wantlistForPeer(e){let t=e.toB58String(),n=this.ledgerMap.get(t);return n?n.wantlist.sortedEntries():new Map}ledgerForPeer(e){let t=e.toB58String(),n=this.ledgerMap.get(t);return n?{peer:n.partner,value:n.debtRatio(),sent:n.accounting.bytesSent,recv:n.accounting.bytesRecv,exchanged:n.exchangeCount}:null}peers(){return Array.from(this.ledgerMap.values()).map(e=>e.partner)}receivedBlocks(e){if(!!e.length){for(let t of this.ledgerMap.values())for(let n of e){let i=t.wantlistContains(n.cid);if(!i)continue;let s=n.data.length,o=this._sendAsBlock(i.wantType,s),a=s;o||(a=k.blockPresenceSize(i.cid)),this._requestQueue.pushTasks(t.partner,[{topic:i.cid.toString(B),priority:i.priority,size:a,data:{blockSize:s,isWantBlock:o,haveBlock:!0,sendDontHave:!1}}])}this._scheduleProcessTasks()}}async messageReceived(e,t){let n=this._findOrCreate(e);if(t.empty)return;if(t.full&&(n.wantlist=new le),this._updateBlockAccounting(t.blocks,n),t.wantlist.size===0){this._scheduleProcessTasks();return}let i=[],s=[];t.wantlist.forEach(o=>{o.cancel?(n.cancelWant(o.cid),i.push(o.cid)):(n.wants(o.cid,o.priority,o.wantType),s.push(o))}),this._cancelWants(e,i),await this._addWants(e,s),this._scheduleProcessTasks()}_cancelWants(e,t){for(let n of t)this._requestQueue.remove(n.toString(B),e)}async _addWants(e,t){let n=await this._getBlockSizes(t.map(s=>s.cid)),i=[];for(let s of t){let o=s.cid.toString(B),a=n.get(o);if(a==null)s.sendDontHave&&i.push({topic:o,priority:s.priority,size:k.blockPresenceSize(s.cid),data:{isWantBlock:s.wantType===xo.Block,blockSize:0,haveBlock:!1,sendDontHave:s.sendDontHave}});else{let c=this._sendAsBlock(s.wantType,a),l=a;c||(l=k.blockPresenceSize(s.cid)),i.push({topic:o,priority:s.priority,size:l,data:{isWantBlock:c,blockSize:a,haveBlock:!0,sendDontHave:s.sendDontHave}})}this._requestQueue.pushTasks(e,i)}}_sendAsBlock(e,t){return e===xo.Block||t<=this._opts.maxSizeReplaceHasWithBlock}async _getBlockSizes(e){let t=await this._getBlocks(e);return new Map([...t].map(([n,i])=>[n,i.length]))}async _getBlocks(e){let t=new Map;return await Promise.all(e.map(async n=>{try{let i=await this.blockstore.get(n);t.set(n.toString(B),i)}catch(i){i.code!=="ERR_NOT_FOUND"&&this._log.error("failed to query blockstore for %s: %s",n,i)}})),t}_updateBlockAccounting(e,t){for(let n of e.values())this._log("got block (%s bytes)",n.length),t.receivedBytes(n.length)}messageSent(e,t,n){let i=this._findOrCreate(e);i.sentBytes(n.length),i.wantlist.remove(t)}numBytesSentTo(e){return this._findOrCreate(e).accounting.bytesSent}numBytesReceivedFrom(e){return this._findOrCreate(e).accounting.bytesRecv}peerDisconnected(e){}_findOrCreate(e){let t=e.toB58String(),n=this.ledgerMap.get(t);if(n)return n;let i=new Cr(e);return this.ledgerMap.set(t,i),this._stats&&this._stats.push(t,"peerCount",1),i}start(){this._running=!0}stop(){this._running=!1}};u();var Po=L(Tt());u();u();u();var Mr={};J(Mr,{identity:()=>Xu});u();var Xu=ft({prefix:"\0",name:"identity",encode:r=>Mn(r),decode:r=>On(r)});var Ir={};J(Ir,{base2:()=>Ku});u();var Ku=T({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var Pr={};J(Pr,{base8:()=>Zu});u();var Zu=T({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var jr={};J(jr,{base10:()=>Yu});u();var Yu=we({prefix:"9",name:"base10",alphabet:"0123456789"});var Dr={};J(Dr,{base16:()=>el,base16upper:()=>tl});u();var el=T({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),tl=T({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var Nr={};J(Nr,{base36:()=>rl,base36upper:()=>nl});u();var rl=we({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),nl=we({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var Ur={};J(Ur,{base64:()=>il,base64pad:()=>sl,base64url:()=>ol,base64urlpad:()=>al});u();var il=T({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),sl=T({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),ol=T({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),al=T({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var Rr={};J(Rr,{identity:()=>cl});u();var cl=Ke({name:"identity",code:0,encode:r=>de(r)});u();u();var Kh=new TextEncoder,Zh=new TextDecoder;u();var zr={...Mr,...Ir,...Pr,...jr,...Dr,...Vt,...Nr,...Gt,...Ur},rp={...Jt,...Rr};function Oo(r,e,t,n){return{name:r,prefix:e,encoder:{name:r,prefix:e,encode:t},decoder:{decode:n}}}var Mo=Oo("utf8","u",r=>{let e=new TextDecoder("utf8");return"u"+e.decode(r)},r=>new TextEncoder().encode(r.substring(1))),qr=Oo("ascii","a",r=>{let e="a";for(let t=0;t<r.length;t++)e+=String.fromCharCode(r[t]);return e},r=>{r=r.substring(1);let e=new Uint8Array(r.length);for(let t=0;t<r.length;t++)e[t]=r.charCodeAt(t);return e}),fl={utf8:Mo,"utf-8":Mo,hex:zr.base16,latin1:qr,ascii:qr,binary:qr,...zr},Io=fl;function Wr(r,e="utf8"){let t=Io[e];if(!t)throw new Error(`Unsupported encoding "${e}"`);return t.encoder.encode(r).substring(1)}var jo=r=>`unwant:${Wr(r.multihash.bytes,"base64")}`,Do=r=>`block:${Wr(r.multihash.bytes,"base64")}`,Hr=class extends Po.EventEmitter{constructor(e){super();this.setMaxListeners(Ts),this._log=K(e,"notif")}hasBlock(e,t){let n=Do(e);this._log(n),this.emit(n,t)}wantBlock(e,t={}){if(!e)throw new Error("Not a valid cid");let n=Do(e),i=jo(e);return this._log(`wantBlock:${e}`),new Promise((s,o)=>{let a=()=>{this.removeListener(n,c),o(new Error(`Block for ${e} unwanted`))},c=l=>{this.removeListener(i,a),s(l)};this.once(i,a),this.once(n,c),t&&t.signal&&t.signal.addEventListener("abort",()=>{this.removeListener(n,c),this.removeListener(i,a),o(new Error(`Want for ${e} aborted`))})})}unwantBlock(e){let t=jo(e);this._log(t),this.emit(t)}};u();var qo=L(Tt());u();var zo=L(Tt()),$r=L(Ro()),Ft=class extends zo.EventEmitter{constructor(e,t){super();this._options=t,this._queue=[],this._stats={},this._frequencyLastTime=Date.now(),this._frequencyAccumulators={},this._movingAverages={},this._update=this._update.bind(this),e.forEach(n=>{this._stats[n]=BigInt(0),this._movingAverages[n]={},this._options.movingAverageIntervals.forEach(i=>{(this._movingAverages[n][i]=(0,$r.default)(i)).push(this._frequencyLastTime,0)})}),this._enabled=this._options.enabled}enable(){this._enabled=!0}disable(){this._disabled=!0}stop(){this._timeout&&clearTimeout(this._timeout)}get snapshot(){return Object.assign({},this._stats)}get movingAverages(){return Object.assign({},this._movingAverages)}push(e,t){this._enabled&&(this._queue.push([e,t,Date.now()]),this._resetComputeTimeout())}_resetComputeTimeout(){this._timeout&&clearTimeout(this._timeout),this._timeout=setTimeout(this._update,this._nextTimeout())}_nextTimeout(){let e=this._queue.length/this._options.computeThrottleMaxQueueSize;return Math.max(this._options.computeThrottleTimeout*(1-e),0)}_update(){if(this._timeout=null,this._queue.length){let e;for(;this._queue.length;){let t=e=this._queue.shift();t&&this._applyOp(t)}e&&this._updateFrequency(e[2]),this.emit("update",this._stats)}}_updateFrequency(e){let t=e-this._frequencyLastTime;t&&Object.keys(this._stats).forEach(n=>{this._updateFrequencyFor(n,t,e)}),this._frequencyLastTime=e}_updateFrequencyFor(e,t,n){let i=this._frequencyAccumulators[e]||0;this._frequencyAccumulators[e]=0;let s=i/t*1e3,o=this._movingAverages[e];o||(o=this._movingAverages[e]={}),this._options.movingAverageIntervals.forEach(a=>{let c=o[a];c||(c=o[a]=(0,$r.default)(a)),c.push(n,s)})}_applyOp(e){let t=e[0],n=e[1];if(typeof n!="number")throw new Error(`invalid increment number: ${n}`);Object.prototype.hasOwnProperty.call(this._stats,t)||(this._stats[t]=BigInt(0)),this._stats[t]=BigInt(this._stats[t])+BigInt(n),this._frequencyAccumulators[t]||(this._frequencyAccumulators[t]=0),this._frequencyAccumulators[t]+=n}};var Wo={enabled:!1,computeThrottleTimeout:1e3,computeThrottleMaxQueueSize:1e3,movingAverageIntervals:[60*1e3,5*60*1e3,15*60*1e3]},Gr=class extends qo.EventEmitter{constructor(e=[],t=Wo){super();let n=Object.assign({},Wo,t);if(typeof n.computeThrottleTimeout!="number")throw new Error("need computeThrottleTimeout");if(typeof n.computeThrottleMaxQueueSize!="number")throw new Error("need computeThrottleMaxQueueSize");this._initialCounters=e,this._options=n,this._enabled=this._options.enabled,this._global=new Ft(e,n),this._global.on("update",i=>this.emit("update",i)),this._peers=new Map}enable(){this._enabled=!0,this._options.enabled=!0,this._global.enable()}disable(){this._enabled=!1,this._options.enabled=!1,this._global.disable()}stop(){this._enabled=!1,this._global.stop();for(let e of this._peers)e[1].stop()}get snapshot(){return this._global.snapshot}get movingAverages(){return this._global.movingAverages}forPeer(e){let t=typeof e!="string"&&e.toB58String?e.toB58String():`${e}`;return this._peers.get(t)}push(e,t,n){if(this._enabled&&(this._global.push(t,n),e)){let i=this._peers.get(e);i||(i=new Ft(this._initialCounters,this._options),this._peers.set(e,i)),i.push(t,n)}}disconnected(e){let t=e.toB58String(),n=this._peers.get(t);n&&(n.stop(),this._peers.delete(t))}};var ia=L(Jr()),sa=L(Vo());u();var Xr=L(Qo()),Fe=L(Ko()),Kr=L(Yo()),ra=L(ta()),na=(r,e)=>async function*(){yield*(await(0,ra.default)(r)).sort(e)}(),Zr=class{open(){return Promise.reject(new Error(".open is not implemented"))}close(){return Promise.reject(new Error(".close is not implemented"))}put(e,t,n){return Promise.reject(new Error(".put is not implemented"))}get(e,t){return Promise.reject(new Error(".get is not implemented"))}has(e,t){return Promise.reject(new Error(".has is not implemented"))}delete(e,t){return Promise.reject(new Error(".delete is not implemented"))}async*putMany(e,t={}){for await(let{key:n,value:i}of e)await this.put(n,i,t),yield{key:n,value:i}}async*getMany(e,t={}){for await(let n of e)yield this.get(n,t)}async*deleteMany(e,t={}){for await(let n of e)await this.delete(n,t),yield n}batch(){let e=[],t=[];return{put(n,i){e.push({key:n,value:i})},delete(n){t.push(n)},commit:async n=>{await(0,Xr.default)(this.putMany(e,n)),e=[],await(0,Xr.default)(this.deleteMany(t,n)),t=[]}}}async*_all(e,t){throw new Error("._all is not implemented")}async*_allKeys(e,t){throw new Error("._allKeys is not implemented")}query(e,t){let n=this._all(e,t);if(e.prefix!=null&&(n=(0,Fe.default)(n,i=>i.key.toString().startsWith(e.prefix||""))),Array.isArray(e.filters)&&(n=e.filters.reduce((i,s)=>(0,Fe.default)(i,s),n)),Array.isArray(e.orders)&&(n=e.orders.reduce((i,s)=>na(i,s),n)),e.offset!=null){let i=0;n=(0,Fe.default)(n,()=>i++>=(e.offset||0))}return e.limit!=null&&(n=(0,Kr.default)(n,e.limit)),n}queryKeys(e,t){let n=this._allKeys(e,t);if(e.prefix!=null&&(n=(0,Fe.default)(n,i=>i.toString().startsWith(e.prefix||""))),Array.isArray(e.filters)&&(n=e.filters.reduce((i,s)=>(0,Fe.default)(i,s),n)),Array.isArray(e.orders)&&(n=e.orders.reduce((i,s)=>na(i,s),n)),e.offset!=null){let i=0;n=(0,Fe.default)(n,()=>i++>=e.offset)}return e.limit!=null&&(n=(0,Kr.default)(n,e.limit)),n}};var bl={statsEnabled:!1,statsComputeThrottleTimeout:1e3,statsComputeThrottleMaxQueueSize:1e3},_l=["blocksReceived","dataReceived","dupBlksReceived","dupDataReceived","blocksSent","dataSent","providesBufferLength","wantListLength","peerCount"],Yr=class extends Zr{constructor(e,t,n={}){super();this._libp2p=e,this._log=K(this.peerId),this._options=Object.assign({},bl,n),this._stats=new Gr(_l,{enabled:this._options.statsEnabled,computeThrottleTimeout:this._options.statsComputeThrottleTimeout,computeThrottleMaxQueueSize:this._options.statsComputeThrottleMaxQueueSize}),this.network=new Ar(e,this,this._stats,{hashLoader:n.hashLoader}),this.blockstore=t,this.engine=new Lr(this.peerId,t,this.network,this._stats),this.wm=new dr(this.peerId,this.network,this._stats),this.notifications=new Hr(this.peerId),this.started=!1}isStarted(){return this.started}get peerId(){return this._libp2p.peerId}async _receiveMessage(e,t){try{await this.engine.messageReceived(e,t)}catch(i){this._log("failed to receive message",t)}if(t.blocks.size===0)return;let n=[];for(let[i,s]of t.blocks.entries()){let o=E.parse(i);n.push({wasWanted:this.wm.wantlist.contains(o),cid:o,data:s})}this.wm.cancelWants(n.filter(({wasWanted:i})=>i).map(({cid:i})=>i)),await Promise.all(n.map(({cid:i,wasWanted:s,data:o})=>this._handleReceivedBlock(e,i,o,s)))}async _handleReceivedBlock(e,t,n,i){this._log("received block");let s=await this.blockstore.has(t);this._updateReceiveCounters(e.toB58String(),t,n,s),!!i&&await this.put(t,n)}_updateReceiveCounters(e,t,n,i){this._stats.push(e,"blocksReceived",1),this._stats.push(e,"dataReceived",n.length),i&&(this._stats.push(e,"dupBlksReceived",1),this._stats.push(e,"dupDataReceived",n.length))}_receiveError(e){this._log.error("ReceiveError: %s",e.message)}_onPeerConnected(e){this.wm.connected(e)}_onPeerDisconnected(e){this.wm.disconnected(e),this.engine.peerDisconnected(e),this._stats.disconnected(e)}enableStats(){this._stats.enable()}disableStats(){this._stats.disable()}wantlistForPeer(e,t){return this.engine.wantlistForPeer(e)}ledgerForPeer(e){return this.engine.ledgerForPeer(e)}async get(e,t={}){let n=(l,f)=>(this.wm.wantBlocks([l],f),this.notifications.wantBlock(l,f)),i=!1,s=async(l,f)=>{try{return await this.blockstore.get(l,f)}catch(p){if(p.code!=="ERR_NOT_FOUND")throw p;return i||(i=!0,this.network.findAndConnect(l).catch(m=>this._log.error(m))),n(l,f)}},o=new ia.AbortController,a=t.signal?(0,sa.anySignal)([t.signal,o.signal]):o.signal,c=await Promise.race([this.notifications.wantBlock(e,{signal:a}),s(e,{signal:a})]);return o.abort(),c}async*getMany(e,t={}){for await(let n of e)yield this.get(n,t)}unwant(e){let t=Array.isArray(e)?e:[e];this.wm.unwantBlocks(t),t.forEach(n=>this.notifications.unwantBlock(n))}cancelWants(e){this.wm.cancelWants(Array.isArray(e)?e:[e])}async put(e,t,n){await this.blockstore.put(e,t),this._sendHaveBlockNotifications(e,t)}async*putMany(e,t){for await(let{key:n,value:i}of this.blockstore.putMany(e,t))this._sendHaveBlockNotifications(n,i),yield{key:n,value:i}}_sendHaveBlockNotifications(e,t){this.notifications.hasBlock(e,t),this.engine.receivedBlocks([{cid:e,data:t}]),this.network.provide(e).catch(n=>{this._log.error("Failed to provide: %s",n.message)})}getWantlist(){return this.wm.wantlist.entries()}peers(){return this.engine.peers()}stat(){return this._stats}start(){this.wm.start(),this.network.start(),this.engine.start(),this.started=!0}stop(){this._stats.stop(),this.wm.stop(),this.network.stop(),this.engine.stop(),this.started=!1}unwrap(){return this.blockstore}};var xl=(r,e,t={})=>new Yr(r,e,t);return Bl;})();
/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */
/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */
return IpfsBitswap}));
